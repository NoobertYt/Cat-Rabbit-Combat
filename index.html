<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KotoKombat</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  <style>
    .kotokrolik {
      transition: transform 0.1s;
    }
    .kotokrolik:active {
      transform: scale(0.9);
    }
    #user-id {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(255 255 255 / 0.8);
      padding: 6px 10px;
      border-radius: 8px;
      font-weight: bold;
      color: #5b21b6;
      box-shadow: 0 0 6px rgba(91,33,182,0.6);
      z-index: 1000;
      user-select: text;
    }
    #airdrop-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(3px);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    #airdrop-modal.active {
      display: flex;
    }
    #shop-upgrades, #shop-skins, #shop-businesses {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      max-width: 350px;
      width: 100%;
      padding: 1rem;
      margin-top: 1rem;
      text-align: left;
      max-height: 400px;
      overflow-y: auto;
    }
    #shop-upgrades.hidden, #shop-skins.hidden, #shop-businesses.hidden {
      display: none;
    }
    .shop-item {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    .shop-item:last-child {
      border-bottom: none;
    }
    .shop-item button {
      background: #6366f1;
      color: white;
      padding: 0.3rem 0.7rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .shop-item button:hover:enabled {
      background: #4f46e5;
    }
    .skin-preview {
      width: 64px;
      height: 64px;
      border-radius: 0.75rem;
      object-fit: cover;
      border: 2px solid #ddd;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-pink-100 to-purple-200 min-h-screen flex flex-col items-center justify-center p-6 gap-6">

  <div id="user-id">ID: <span id="uid"></span></div>
  <script>
    const uid = localStorage.getItem("user_id") || Math.floor(100000 + Math.random() * 900000);
    localStorage.setItem("user_id", uid);
    document.getElementById("uid").innerText = uid;
  </script>

  <div class="bg-white shadow-2xl rounded-2xl p-4 w-full max-w-sm text-center">
    <img id="kotokrolik-img" src="images/kotokrolik.jpg" class="kotokrolik w-48 h-48 mx-auto rounded-full border-4 border-purple-300 shadow-lg cursor-pointer" onclick="tap()">
    <p id="kotokrolik-name" class="text-lg font-medium text-purple-800 mt-4">–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº</p>
    <p id="score" class="text-2xl font-bold text-pink-600">Kotokrocoin: 0 ü™ô</p>
    <p id="energy" class="text-md font-medium text-blue-600">–≠–Ω–µ—Ä–≥–∏—è: 100/100 ‚ö°</p>

    <div class="flex flex-col gap-2 mt-4">
      <button onclick="toggleShop('upgrades')" class="bg-green-500 hover:bg-green-600 text-white rounded-xl px-4 py-2 shadow">–ê–ø–≥—Ä–µ–π–¥—ã üõ†Ô∏è</button>
      <button onclick="toggleShop('skins')" class="bg-purple-500 hover:bg-purple-600 text-white rounded-xl px-4 py-2 shadow">–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ üé®</button>
      <button onclick="toggleShop('businesses')" class="bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl px-4 py-2 shadow">–ë–∏–∑–Ω–µ—Å—ã üè≠</button>
      <button onclick="openAirdrop()" class="bg-yellow-400 hover:bg-yellow-500 text-white rounded-xl px-4 py-2 shadow">Airdrop üì¶</button>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω –∞–ø–≥—Ä–µ–π–¥–æ–≤ -->
    <div id="shop-upgrades" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-green-700">–ê–ø–≥—Ä–µ–π–¥—ã</h3>

      <div class="shop-item">
        <div>
          <strong>–£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞</strong><br />
          <small>+1 –∫ –º–æ–Ω–µ—Ç–∞–º –∑–∞ –∫–ª–∏–∫</small><br />
          <small>–£—Ä–æ–≤–µ–Ω—å: <span id="upgrade-level">0</span></small><br />
          <small>–¶–µ–Ω–∞: <span id="upgrade-cost"></span> ü™ô</small>
        </div>
        <button id="buy-upgrade-btn">–ö—É–ø–∏—Ç—å</button>
      </div>

      <div class="shop-item">
        <div>
          <strong>–£–ª—É—á—à–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏</strong><br />
          <small>+20 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏</small><br />
          <small>–£—Ä–æ–≤–µ–Ω—å: <span id="energy-upgrade-level">0</span></small><br />
          <small>–¶–µ–Ω–∞: <span id="energy-upgrade-cost"></span> ü™ô</small>
        </div>
        <button id="buy-energy-upgrade-btn">–ö—É–ø–∏—Ç—å</button>
      </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ -->
    <div id="shop-skins" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-purple-700">–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</h3>
      <div id="skins-list"></div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω –±–∏–∑–Ω–µ—Å–æ–≤ -->
    <div id="shop-businesses" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-indigo-700">–ë–∏–∑–Ω–µ—Å—ã</h3>
      <div id="businesses-list"></div>
      <p class="mt-4 text-sm text-gray-600">–î–æ—Ö–æ–¥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.</p>
    </div>
  </div>

  <!-- Airdrop Modal -->
  <div id="airdrop-modal" class="items-center">
    <div class="bg-white p-6 rounded-xl shadow-xl max-w-sm w-full relative">
      <button onclick="closeAirdrop()" class="absolute top-2 right-2 text-red-500 font-bold">‚úï</button>
      <h2 class="text-lg font-bold text-yellow-500 mb-4">–ó–∞–ø—Ä–æ—Å –Ω–∞ Airdrop</h2>
      <form id="airdrop-form">
        <label class="block mb-2 text-sm font-medium">ID –∞–∫–∫–∞—É–Ω—Ç–∞</label>
        <input type="text" id="airdrop-id" class="w-full mb-4 p-2 border rounded" readonly />

        <label class="block mb-2 text-sm font-medium">–ü–æ—á–µ–º—É —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å airdrop?</label>
        <textarea id="airdrop-reason" class="w-full mb-4 p-2 border rounded" rows="2"></textarea>

        <label class="block mb-2 text-sm font-medium">–°–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç —Ç—ã —Ö–æ—á–µ—à—å?</label>
        <input type="number" id="airdrop-amount" class="w-full mb-4 p-2 border rounded" />

        <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded w-full">–û—Ç–ø—Ä–∞–≤–∏—Ç—å üöÄ</button>
      </form>
    </div>
  </div>

  <script>
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1340000403462422528/1on5uXxAxOrHfdMWtVlboXGJIAOpbg0dyHs8ovPKysDHZEIg4IuIiCSRj7ErXGefGP18";
    const userId = localStorage.getItem("user_id") || "unknown";

    const skins = [
      { id: 0, name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº", image: "images/kotokrolik.jpg", owned: true, price: 0 },
      { id: 1, name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏—Ç–∫–∞ üéÄ", image: "images/kotokrolitka.jpg", owned: false, price: 50 }
    ];

    const businesses = [
      { id: 0, name: "–ö–æ—Ñ–µ–π–Ω—è ‚òï", price: 100, income: 1, owned: false },
      { id: 1, name: "–ü–µ–∫–∞—Ä–Ω—è ü•ê", price: 300, income: 3, owned: false },
      { id: 2, name: "–ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω üìö", price: 800, income: 8, owned: false },
      { id: 3, name: "–ë—É—Ä–≥–µ—Ä –ö–∏–Ω–≥ üçî", price: 5000, income: 40, owned: false }  // –î–æ–±–∞–≤–ª–µ–Ω –±–∏–∑–Ω–µ—Å
    ];

    let score = 0;
    let energy = 100;
    let maxEnergy = 100;
    let clickPower = 1;
    let upgradeLevel = 0;
    let energyUpgradeLevel = 0;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function loadProgress() {
      score = Number(localStorage.getItem("score")) || 0;
      energy = Number(localStorage.getItem("energy")) || 100;
      maxEnergy = Number(localStorage.getItem("maxEnergy")) || 100;
      clickPower = Number(localStorage.getItem("clickPower")) || 1;
      upgradeLevel = Number(localStorage.getItem("upgradeLevel")) || 0;
      energyUpgradeLevel = Number(localStorage.getItem("energyUpgradeLevel")) || 0;
      for (let b of businesses) {
        const owned = localStorage.getItem("business_owned_" + b.id);
        b.owned = owned === "true";
      }
      for (let s of skins) {
        const owned = localStorage.getItem("skin_owned_" + s.id);
        if (owned === "true") s.owned = true;
      }
      
      // –û—Ñ—Ñ–ª–∞–π–Ω –¥–æ—Ö–æ–¥
      const lastTime = Number(localStorage.getItem("last_time")) || Date.now();
      const now = Date.now();
      const deltaSec = Math.floor((now - lastTime) / 1000);
      if (deltaSec > 0) {
        let offlineIncome = 0;
        for (let b of businesses) {
          if (b.owned) offlineIncome += b.income * deltaSec;
        }
        if (offlineIncome > 0) {
          alert(`–í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ ${offlineIncome} ü™ô –ø–æ–∫–∞ –±—ã–ª–∏ –æ—Ñ—Ñ–ª–∞–π–Ω!`);
          score += offlineIncome;
        }
      }
      localStorage.setItem("last_time", now);

      updateUI();
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function saveProgress() {
      localStorage.setItem("score", score);
      localStorage.setItem("energy", energy);
      localStorage.setItem("maxEnergy", maxEnergy);
      localStorage.setItem("clickPower", clickPower);
      localStorage.setItem("upgradeLevel", upgradeLevel);
      localStorage.setItem("energyUpgradeLevel", energyUpgradeLevel);
      localStorage.setItem("last_time", Date.now());
      for (let b of businesses) {
        localStorage.setItem("business_owned_" + b.id, b.owned);
      }
      for (let s of skins) {
        localStorage.setItem("skin_owned_" + s.id, s.owned);
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
    function updateUI() {
      document.getElementById("score").innerText = `Kotokrocoin: ${score} ü™ô`;
      document.getElementById("energy").innerText = `–≠–Ω–µ—Ä–≥–∏—è: ${energy}/${maxEnergy} ‚ö°`;
      document.getElementById("upgrade-level").innerText = upgradeLevel;
      document.getElementById("energy-upgrade-level").innerText = energyUpgradeLevel;
      document.getElementById("upgrade-cost").innerText = upgradeCost();
      document.getElementById("energy-upgrade-cost").innerText = energyUpgradeCost();

      // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–∫–∏–Ω–æ–≤
      const skinsList = document.getElementById("skins-list");
      skinsList.innerHTML = "";
      for (let skin of skins) {
        const div = document.createElement("div");
        div.className = "shop-item";

        const img = document.createElement("img");
        img.src = skin.image;
        img.alt = skin.name;
        img.className = "skin-preview";

        const info = document.createElement("div");
        info.innerHTML = `<strong>${skin.name}</strong><br>–¶–µ–Ω–∞: ${skin.price} ü™ô<br>${skin.owned ? "–ö—É–ø–ª–µ–Ω–æ" : ""}`;

        const btn = document.createElement("button");
        btn.disabled = skin.owned || score < skin.price;
        btn.innerText = skin.owned ? "–ö—É–ø–ª–µ–Ω–æ" : "–ö—É–ø–∏—Ç—å";
        btn.onclick = () => buySkin(skin.id);

        div.appendChild(img);
        div.appendChild(info);
        div.appendChild(btn);

        skinsList.appendChild(div);
      }

      // –û–±–Ω–æ–≤–∏—Ç—å –±–∏–∑–Ω–µ—Å—ã
      const businessesList = document.getElementById("businesses-list");
      businessesList.innerHTML = "";
      for (let b of businesses) {
        const div = document.createElement("div");
        div.className = "shop-item";

        const info = document.createElement("div");
        info.innerHTML = `<strong>${b.name}</strong><br>–¶–µ–Ω–∞: ${b.price} ü™ô<br>–î–æ—Ö–æ–¥: ${b.income} ü™ô/—Å–µ–∫<br>${b.owned ? "–ö—É–ø–ª–µ–Ω–æ" : ""}`;

        const btn = document.createElement("button");
        btn.disabled = b.owned || score < b.price;
        btn.innerText = b.owned ? "–ö—É–ø–ª–µ–Ω–æ" : "–ö—É–ø–∏—Ç—å";
        btn.onclick = () => buyBusiness(b.id);

        div.appendChild(info);
        div.appendChild(btn);

        businessesList.appendChild(div);
      }
    }

    // –°—Ç–æ–∏–º–æ—Å—Ç—å –∞–ø–≥—Ä–µ–π–¥–æ–≤
    function upgradeCost() {
      return 50 * (upgradeLevel + 1);
    }
    function energyUpgradeCost() {
      return 75 * (energyUpgradeLevel + 1);
    }

    // –ö–ª–∏–∫ –ø–æ –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫—É
    function tap() {
      if (energy < 1) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏! –ü–æ–¥–æ–∂–¥–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.");
        return;
      }
      score += clickPower;
      energy--;
      saveProgress();
      updateUI();
    }

    // –ü–æ–∫—É–ø–∫–∞ –∞–ø–≥—Ä–µ–π–¥–∞ –∫–ª–∏–∫–∞
    document.getElementById("buy-upgrade-btn").onclick = () => {
      const cost = upgradeCost();
      if (score >= cost) {
        score -= cost;
        upgradeLevel++;
        clickPower++;
        saveProgress();
        updateUI();
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–ª–∏–∫–∞.");
      }
    };

    // –ü–æ–∫—É–ø–∫–∞ –∞–ø–≥—Ä–µ–π–¥–∞ —ç–Ω–µ—Ä–≥–∏–∏
    document.getElementById("buy-energy-upgrade-btn").onclick = () => {
      const cost = energyUpgradeCost();
      if (score >= cost) {
        score -= cost;
        energyUpgradeLevel++;
        maxEnergy += 20;
        energy = maxEnergy;
        saveProgress();
        updateUI();
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏.");
      }
    };

    // –ü–æ–∫—É–ø–∫–∞ —Å–∫–∏–Ω–∞
    function buySkin(id) {
      const skin = skins.find(s => s.id === id);
      if (!skin || skin.owned) return;
      if (score >= skin.price) {
        score -= skin.price;
        skin.owned = true;
        document.getElementById("kotokrolik-img").src = skin.image;
        document.getElementById("kotokrolik-name").innerText = skin.name;
        saveProgress();
        updateUI();
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Å–∫–∏–Ω–∞.");
      }
    }

    // –ü–æ–∫—É–ø–∫–∞ –±–∏–∑–Ω–µ—Å–∞
    function buyBusiness(id) {
      const business = businesses.find(b => b.id === id);
      if (!business || business.owned) return;
      if (score >= business.price) {
        score -= business.price;
        business.owned = true;
        saveProgress();
        updateUI();
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –±–∏–∑–Ω–µ—Å–∞.");
      }
    }

    // –î–æ—Ö–æ–¥ –æ—Ç –±–∏–∑–Ω–µ—Å–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    setInterval(() => {
      let income = 0;
      for (let b of businesses) {
        if (b.owned) income += b.income;
      }
      if (income > 0) {
        score += income;
        saveProgress();
        updateUI();
      }
    }, 1000);

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    setInterval(() => {
      if (energy < maxEnergy) {
        energy++;
        saveProgress();
        updateUI();
      }
    }, 2000);

    // –ú–∞–≥–∞–∑–∏–Ω—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
    function toggleShop(name) {
      const shops = ["upgrades", "skins", "businesses"];
      for (let s of shops) {
        document.getElementById(`shop-${s}`).classList.add("hidden");
      }
      document.getElementById(`shop-${name}`).classList.remove("hidden");
    }

    // Airdrop
    function openAirdrop() {
      document.getElementById("airdrop-id").value = userId;
      document.getElementById("airdrop-reason").value = "";
      document.getElementById("airdrop-amount").value = "";
      document.getElementById("airdrop-modal").classList.add("active");
    }
    function closeAirdrop() {
      document.getElementById("airdrop-modal").classList.remove("active");
    }
    document.getElementById("airdrop-form").onsubmit = (e) => {
      e.preventDefault();
      const reason = document.getElementById("airdrop-reason").value.trim();
      const amount = Number(document.getElementById("airdrop-amount").value.trim());
      if (!reason) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É.");
        return;
      }
      if (!amount || amount <= 0) {
        alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç.");
        return;
      }

      fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          content: `Airdrop request:\nID: ${userId}\nAmount: ${amount}\nReason: ${reason}`
        })
      }).then(() => {
        alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è.");
        closeAirdrop();
      }).catch(() => {
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏.");
      });
    };

    loadProgress();
  </script>

</body>
</html>
