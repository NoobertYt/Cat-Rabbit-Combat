<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KotoKombat - –ó–∞–≤–æ–¥—å –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
    
    :root {
      --primary: #8b5cf6;
      --secondary: #ec4899;
      --accent: #f59e0b;
      --dark: #1f2937;
      --light: #fdf2f8;
    }
    
    body {
      font-family: 'Comic Neue', cursive;
      background: linear-gradient(135deg, #fdf4ff 0%, #fce7f3 100%);
      min-height: 100vh;
      color: var(--dark);
    }
    
    .game-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header-gradient {
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .character-container {
      position: relative;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .character-img {
      width: 220px;
      height: 220px;
      object-fit: cover;
      border: 4px solid #ddd6fe;
      border-radius: 20px;
      box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.4), 0 5px 10px -5px rgba(236, 72, 153, 0.2);
    }
    
    .character-container:active {
      transform: scale(0.95);
    }
    
    .floating-coin {
      position: absolute;
      color: #f59e0b;
      font-size: 1.5rem;
      pointer-events: none;
      animation: floatUp 1s ease-in-out forwards;
      z-index: 20;
    }
    
    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-80px) scale(1.5);
      }
    }
    
    .pulse {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .progress-bar {
      height: 1rem;
      border-radius: 9999px;
      background: #e5e7eb;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 9999px;
      background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
      transition: width 0.3s ease;
    }
    
    .shop-item {
      transition: all 0.2s ease;
      border-left: 4px solid transparent;
    }
    
    .shop-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary);
    }
    
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    .tab-button {
      transition: all 0.2s ease;
      border-bottom: 3px solid transparent;
    }
    
    .tab-button.active {
      border-bottom-color: var(--primary);
      color: var(--primary);
    }
    
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem;
      border-radius: 0.5rem;
      background: white;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      max-width: 300px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .energy-low {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .ban-modal {
      background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%) !important;
    }
    
    .ban-text {
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .stat-card {
      background: white;
      padding: 1rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .business-card {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid #e2e8f0;
      transition: all 0.3s ease;
    }
    
    .business-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.2);
    }
    
    .business-owned {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-color: #10b981;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
      .character-img {
        width: 180px;
        height: 180px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="min-h-screen p-4">
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–∞–Ω–∞ -->
  <div id="ban-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
    <div class="ban-modal rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
      <div class="p-6 text-center">
        <div class="text-6xl mb-4">üö´</div>
        <h2 class="text-2xl font-bold ban-text mb-2">–í–´ –ó–ê–ë–ê–ù–ï–ù–´</h2>
        <p id="ban-reason" class="ban-text mb-4 text-lg">–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã</p>
        <p class="ban-text opacity-90 mb-6">–î–æ—Å—Ç—É–ø –∫ –∏–≥—Ä–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</p>
        <button onclick="location.reload()" class="bg-white text-red-600 font-bold py-3 px-6 rounded-lg hover:bg-gray-100 transition-colors">
          –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞
        </button>
      </div>
    </div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∏–≥—Ä—ã -->
  <div id="game-content">
    <div class="game-container">
      <!-- –®–∞–ø–∫–∞ -->
      <header class="flex justify-between items-center mb-6 p-4 bg-white rounded-xl shadow-lg">
        <div>
          <h1 class="text-3xl font-bold header-gradient">KotoKombat <i class="fas fa-paw"></i></h1>
          <p class="text-sm text-gray-600">–ó–∞–≤–æ–¥—å –º–∏–ª—ã—Ö –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã!</p>
        </div>
        <div class="bg-purple-100 px-4 py-2 rounded-lg font-mono text-purple-800">
          ID: <span id="uid" class="font-bold">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          <div id="ban-status" class="text-xs px-2 py-1 rounded bg-green-100 text-green-800 mt-1">–°—Ç–∞—Ç—É—Å: –ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
        </div>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
        <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-6">
          <div class="flex flex-col items-center justify-center">
            <div class="character-container relative mb-6" id="character-container">
              <img id="kotokrolik-img" src="images/kotokrolik.jpg" class="character-img rounded-lg pulse" onerror="this.onerror=null; this.src='https://placekitten.com/200/200'">
              <div id="floating-coins"></div>
            </div>
            
            <div class="text-center mb-6">
              <p id="kotokrolik-name" class="text-xl font-bold text-purple-700 mb-2">–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº</p>
              <p id="score" class="text-3xl font-bold text-amber-500 mb-2">0 ü™ô</p>
              <div class="w-full max-w-xs mx-auto mb-2">
                <p class="text-sm font-medium text-blue-600 mb-1">–≠–Ω–µ—Ä–≥–∏—è ‚ö°</p>
                <div class="progress-bar">
                  <div id="energy-bar" class="progress-fill" style="width: 100%;"></div>
                </div>
                <p id="energy-text" class="text-sm text-right mt-1 text-gray-600">100/100</p>
              </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-grid w-full max-w-md mb-6">
              <div class="stat-card text-center">
                <div class="text-2xl font-bold text-purple-600" id="cpc-display">1</div>
                <div class="text-sm text-gray-600">–ú–æ–Ω–µ—Ç/–∫–ª–∏–∫</div>
              </div>
              <div class="stat-card text-center">
                <div class="text-2xl font-bold text-blue-600" id="income-display">0</div>
                <div class="text-sm text-gray-600">–ú–æ–Ω–µ—Ç/—Å–µ–∫</div>
              </div>
              <div class="stat-card text-center">
                <div class="text-2xl font-bold text-green-600" id="businesses-owned">0</div>
                <div class="text-sm text-gray-600">–ë–∏–∑–Ω–µ—Å–æ–≤</div>
              </div>
            </div>

            <button onclick="tap()" class="w-full max-w-md bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-4 rounded-xl shadow-md transition-all duration-200 transform hover:scale-105 text-lg">
              <i class="fas fa-hand-point-up mr-2"></i>–ö–ª–∏–∫–Ω–∏ –ø–æ –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫—É!
            </button>
          </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ú–∞–≥–∞–∑–∏–Ω –∏ –±–∏–∑–Ω–µ—Å—ã -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
          <h2 class="text-xl font-bold text-purple-800 mb-4 flex items-center">
            <i class="fas fa-store mr-2"></i> –ú–∞–≥–∞–∑–∏–Ω
          </h2>
          
          <div class="flex border-b border-gray-200 mb-4">
            <button id="tab-upgrades" class="tab-button active flex-1 py-2 text-center font-medium" onclick="switchTab('upgrades')">
              <i class="fas fa-tools mr-1"></i> –£–ª—É—á—à–µ–Ω–∏—è
            </button>
            <button id="tab-skins" class="tab-button flex-1 py-2 text-center font-medium" onclick="switchTab('skins')">
              <i class="fas fa-palette mr-1"></i> –°–∫–∏–Ω—ã
            </button>
            <button id="tab-businesses" class="tab-button flex-1 py-2 text-center font-medium" onclick="switchTab('businesses')">
              <i class="fas fa-industry mr-1"></i> –ë–∏–∑–Ω–µ—Å—ã
            </button>
          </div>
          
          <div id="shop-upgrades" class="shop-tab">
            <div class="shop-item bg-gray-50 p-4 rounded-lg mb-3">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="font-bold text-gray-800">–£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞</h3>
                  <p class="text-sm text-gray-600">+1 –∫ –º–æ–Ω–µ—Ç–∞–º –∑–∞ –∫–ª–∏–∫</p>
                  <div class="flex items-center mt-1">
                    <span class="badge bg-purple-100 text-purple-800">–£—Ä. <span id="upgrade-level">0</span></span>
                    <span class="text-amber-600 font-bold ml-2"><i class="fas fa-coins mr-1"></i> <span id="upgrade-cost">50</span></span>
                  </div>
                </div>
                <button onclick="buyUpgrade()" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                  –ö—É–ø–∏—Ç—å
                </button>
              </div>
            </div>
            
            <div class="shop-item bg-gray-50 p-4 rounded-lg mb-3">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="font-bold text-gray-800">–£–ª—É—á—à–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏</h3>
                  <p class="text-sm text-gray-600">+20 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏</p>
                  <div class="flex items-center mt-1">
                    <span class="badge bg-blue-100 text-blue-800">–£—Ä. <span id="energy-upgrade-level">0</span></span>
                    <span class="text-amber-600 font-bold ml-2"><i class="fas fa-coins mr-1"></i> <span id="energy-upgrade-cost">50</span></span>
                  </div>
                </div>
                <button onclick="buyEnergyUpgrade()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                  –ö—É–ø–∏—Ç—å
                </button>
              </div>
            </div>
            
            <div class="shop-item bg-gray-50 p-4 rounded-lg">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="font-bold text-gray-800">–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</h3>
                  <p class="text-sm text-gray-600">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–ª–∏–∫–∞–µ—Ç –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥</p>
                  <div class="flex items-center mt-1">
                    <span class="badge bg-green-100 text-green-800">–£—Ä. <span id="autoclicker-level">0</span></span>
                    <span class="text-amber-600 font-bold ml-2"><i class="fas fa-coins mr-1"></i> <span id="autoclicker-cost">1000</span></span>
                  </div>
                </div>
                <button onclick="buyAutoclicker()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                  –ö—É–ø–∏—Ç—å
                </button>
              </div>
            </div>
          </div>
          
          <div id="shop-skins" class="shop-tab hidden">
            <div id="skins-list" class="space-y-3"></div>
          </div>
          
          <div id="shop-businesses" class="shop-tab hidden">
            <div class="mb-4 p-3 bg-blue-50 rounded-lg">
              <p class="text-sm text-blue-800 flex items-center">
                <i class="fas fa-info-circle mr-2"></i>
                –î–æ—Ö–æ–¥ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É. –í—Å–µ–≥–æ –¥–æ—Ö–æ–¥: <span id="total-income" class="font-bold">0</span> ü™ô/—Å–µ–∫
              </p>
            </div>
            <div id="businesses-list" class="space-y-3 max-h-[500px] overflow-y-auto pr-2"></div>
          </div>
        </div>
      </div>

      <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
      <div id="notification" class="notification">
        <div class="flex items-start">
          <div id="notification-icon" class="mr-3 text-xl"></div>
          <div>
            <h3 id="notification-title" class="font-bold"></h3>
            <p id="notification-message" class="text-sm"></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="loading-screen" class="fixed inset-0 bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center z-50">
    <div class="text-center">
      <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600 mx-auto mb-4"></div>
      <h2 class="text-2xl font-bold text-purple-800 mb-2">–ó–∞–≥—Ä—É–∑–∫–∞ KotoKombat...</h2>
      <p class="text-purple-600" id="loading-text">–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É</p>
    </div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Firebase
    let firebaseApp;
    let db;
    let auth;
    let userId = null;
    let userDocRef = null;
    let isBanned = false;
    let autoclickerInterval = null;
    
    // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
    const skins = [
      { 
        id: 0, 
        name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº", 
        image: "images/kotokrolik.jpg", 
        owned: true, 
        price: 0 
      },
      { 
        id: 1, 
        name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏—Ç–∫–∞ üéÄ", 
        image: "images/kotokrolitka.jpg", 
        owned: false, 
        price: 50 
      },
      { 
        id: 2, 
        name: "–ó–æ–ª–æ—Ç–æ–π –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üëë", 
        image: "https://placekitten.com/202/202", 
        owned: false, 
        price: 500 
      },
      { 
        id: 3, 
        name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫-–Ω–∏–Ω–¥–∂–∞ ü•∑", 
        image: "https://placekitten.com/203/203", 
        owned: false, 
        price: 200 
      },
      { 
        id: 4, 
        name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üöÄ", 
        image: "https://placekitten.com/204/204", 
        owned: false, 
        price: 1000 
      }
    ];

    // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–∏–∑–Ω–µ—Å–æ–≤
    const businesses = [
      // –£—Ä–æ–≤–µ–Ω—å 1
      { id: 0, name: "–õ–∞—Ä—ë–∫ —Å –º–æ—Ä–æ–∂–µ–Ω—ã–º üç¶", price: 100, income: 1, owned: false, icon: "fa-ice-cream", tier: 1 },
      { id: 1, name: "–ö–æ—Ñ–µ–π–Ω—è –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤ ‚òï", price: 250, income: 2, owned: false, icon: "fa-mug-hot", tier: 1 },
      { id: 2, name: "–ö–Ω–∏–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω üìö", price: 500, income: 5, owned: false, icon: "fa-book", tier: 1 },
      { id: 3, name: "–¶–≤–µ—Ç–æ—á–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω üå∏", price: 750, income: 8, owned: false, icon: "fa-seedling", tier: 1 },
      
      // –£—Ä–æ–≤–µ–Ω—å 2
      { id: 4, name: "–ü–∏—Ü—Ü–µ—Ä–∏—è üçï", price: 1000, income: 12, owned: false, icon: "fa-pizza-slice", tier: 2 },
      { id: 5, name: "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä üé¨", price: 1500, income: 18, owned: false, icon: "fa-film", tier: 2 },
      { id: 6, name: "–°–ø–æ—Ä—Ç–∑–∞–ª üí™", price: 2000, income: 25, owned: false, icon: "fa-dumbbell", tier: 2 },
      { id: 7, name: "–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã üíá‚Äç‚ôÄÔ∏è", price: 2500, income: 35, owned: false, icon: "fa-spa", tier: 2 },
      
      // –£—Ä–æ–≤–µ–Ω—å 3
      { id: 8, name: "–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç üõí", price: 3500, income: 50, owned: false, icon: "fa-shopping-cart", tier: 3 },
      { id: 9, name: "–ê–≤—Ç–æ—Å–∞–ª–æ–Ω üöó", price: 5000, income: 75, owned: false, icon: "fa-car", tier: 3 },
      { id: 10, name: "–†–µ—Å—Ç–æ—Ä–∞–Ω üçΩÔ∏è", price: 7500, income: 100, owned: false, icon: "fa-utensils", tier: 3 },
      { id: 11, name: "–û—Ç–µ–ª—å üè®", price: 10000, income: 150, owned: false, icon: "fa-hotel", tier: 3 },
      
      // –£—Ä–æ–≤–µ–Ω—å 4
      { id: 12, name: "–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä üõçÔ∏è", price: 15000, income: 250, owned: false, icon: "fa-store", tier: 4 },
      { id: 13, name: "IT –∫–æ–º–ø–∞–Ω–∏—è üíª", price: 20000, income: 400, owned: false, icon: "fa-laptop-code", tier: 4 },
      { id: 14, name: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏—Ä–º–∞ üèóÔ∏è", price: 30000, income: 600, owned: false, icon: "fa-hard-hat", tier: 4 },
      { id: 15, name: "–ë–æ–ª—å–Ω–∏—Ü–∞ üè•", price: 40000, income: 800, owned: false, icon: "fa-hospital", tier: 4 },
      
      // –£—Ä–æ–≤–µ–Ω—å 5
      { id: 16, name: "–ë–∞–Ω–∫ üè¶", price: 50000, income: 1200, owned: false, icon: "fa-university", tier: 5 },
      { id: 17, name: "–ê–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è ‚úàÔ∏è", price: 75000, income: 2000, owned: false, icon: "fa-plane", tier: 5 },
      { id: 18, name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è üöÄ", price: 100000, income: 3000, owned: false, icon: "fa-rocket", tier: 5 },
      { id: 19, name: "–ö—Ä–∏–ø—Ç–æ-—Ñ–µ—Ä–º–∞ ‚Çø", price: 150000, income: 5000, owned: false, icon: "fa-bitcoin", tier: 5 },
      
      // –£—Ä–æ–≤–µ–Ω—å 6 (–ø—Ä–µ–º–∏—É–º)
      { id: 20, name: "–ö—É—Ä–æ—Ä—Ç–Ω—ã–π –æ—Å—Ç—Ä–æ–≤ üèùÔ∏è", price: 250000, income: 10000, owned: false, icon: "fa-umbrella-beach", tier: 6 },
      { id: 21, name: "–ß–∞—Å—Ç–Ω—ã–π –∫–æ—Å–º–æ–ø–æ—Ä—Ç üõ∏", price: 500000, income: 25000, owned: false, icon: "fa-satellite", tier: 6 },
      { id: 22, name: "–ò–º–ø–µ—Ä–∏—è –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤ üëë", price: 1000000, income: 50000, owned: false, icon: "fa-crown", tier: 6 },
      { id: 23, name: "–ü–ª–∞–Ω–µ—Ç–∞ –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤ üåç", price: 5000000, income: 100000, owned: false, icon: "fa-globe", tier: 6 }
    ];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameData = {
      score: 0,
      energy: 100,
      maxEnergy: 100,
      coinsPerClick: 1,
      currentSkin: 0,
      upgradeLevel: 0,
      upgradeCost: 50,
      energyUpgradeLevel: 0,
      energyUpgradeCost: 50,
      autoclickerLevel: 0,
      autoclickerCost: 1000
    };

    // ========================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    // ========================

    async function initFirebase() {
      try {
        updateLoadingText("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...");
        
        if (typeof firebase === 'undefined') {
          throw new Error("Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");
        }
        
        const firebaseConfig = {
          apiKey: "AIzaSyD6b72LrwHZbIslrfVNjwTTJnC8Fu-bkwU",
          authDomain: "kotocrol-d9f49.firebaseapp.com",
          projectId: "kotocrol-d9f49",
          storageBucket: "kotocrol-d9f49.firebasestorage.app",
          messagingSenderId: "559692109036",
          appId: "1:559692109036:web:c4b63571b26dfe3f14c1c9",
          measurementId: "G-ZS81P946ZM"
        };
        
        firebaseApp = firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        auth = firebase.auth();
        
        console.log("Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!");
        
        updateLoadingText("–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è...");
        const authResult = await auth.signInAnonymously();
        userId = authResult.user.uid;
        userDocRef = db.collection("users").doc(userId);
        
        updateLoadingText("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...");
        
        await checkBanStatus();
        await loadGameData();
        
        setupRealtimeListener();
        
        setTimeout(() => {
          document.getElementById("loading-screen").style.display = "none";
          document.getElementById("uid").textContent = userId.substring(0, 8) + "...";
          initGame();
        }, 500);
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ Firebase:", error);
        showNotification("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è", "–ò–≥—Ä–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ", "error");
        setTimeout(() => {
          initLocalStorage();
        }, 1000);
      }
    }

    async function checkBanStatus() {
      try {
        const userDoc = await userDocRef.get();
        
        if (userDoc.exists) {
          const data = userDoc.data();
          if (data.banned) {
            isBanned = true;
            showBanModal(data.banReason || "–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã");
            updateBanStatus(true);
            return false;
          }
        }
        
        updateBanStatus(false);
        return true;
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–Ω–∞:", error);
        return true;
      }
    }

    async function loadGameData() {
      try {
        const userDoc = await userDocRef.get();
        
        if (userDoc.exists) {
          const data = userDoc.data();
          
          gameData.score = data.score || 0;
          gameData.energy = data.energy || 100;
          gameData.maxEnergy = data.maxEnergy || 100;
          gameData.coinsPerClick = data.coinsPerClick || 1;
          gameData.currentSkin = data.currentSkin || 0;
          gameData.upgradeLevel = data.upgradeLevel || 0;
          gameData.upgradeCost = data.upgradeCost || 50;
          gameData.energyUpgradeLevel = data.energyUpgradeLevel || 0;
          gameData.energyUpgradeCost = data.energyUpgradeCost || 50;
          gameData.autoclickerLevel = data.autoclickerLevel || 0;
          gameData.autoclickerCost = data.autoclickerCost || 1000;
          
          if (data.skins && Array.isArray(data.skins)) {
            data.skins.forEach(savedSkin => {
              const skin = skins.find(s => s.id === savedSkin.id);
              if (skin) skin.owned = savedSkin.owned;
            });
          }
          
          if (data.businesses && Array.isArray(data.businesses)) {
            data.businesses.forEach(savedBusiness => {
              const business = businesses.find(b => b.id === savedBusiness.id);
              if (business) business.owned = savedBusiness.owned;
            });
          }
          
        } else {
          await createNewUser();
        }
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
      }
    }

    async function createNewUser() {
      try {
        const initialData = {
          uid: userId,
          score: 0,
          energy: 100,
          maxEnergy: 100,
          coinsPerClick: 1,
          currentSkin: 0,
          upgradeLevel: 0,
          upgradeCost: 50,
          energyUpgradeLevel: 0,
          energyUpgradeCost: 50,
          autoclickerLevel: 0,
          autoclickerCost: 1000,
          skins: skins.map(skin => ({ id: skin.id, owned: skin.id === 0 })),
          businesses: businesses.map(b => ({ id: b.id, owned: false })),
          banned: false,
          banReason: "",
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await userDocRef.set(initialData);
        console.log("–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ Firebase");
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
      }
    }

    async function saveGameData() {
      if (!userDocRef || isBanned) return;
      
      try {
        const saveData = {
          score: gameData.score,
          energy: gameData.energy,
          maxEnergy: gameData.maxEnergy,
          coinsPerClick: gameData.coinsPerClick,
          currentSkin: gameData.currentSkin,
          upgradeLevel: gameData.upgradeLevel,
          upgradeCost: gameData.upgradeCost,
          energyUpgradeLevel: gameData.energyUpgradeLevel,
          energyUpgradeCost: gameData.energyUpgradeCost,
          autoclickerLevel: gameData.autoclickerLevel,
          autoclickerCost: gameData.autoclickerCost,
          skins: skins.map(skin => ({ id: skin.id, owned: skin.owned })),
          businesses: businesses.map(b => ({ id: b.id, owned: b.owned })),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await userDocRef.update(saveData);
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Firebase:", error);
      }
    }

    function setupRealtimeListener() {
      userDocRef.onSnapshot((doc) => {
        if (doc.exists) {
          const data = doc.data();
          
          if (data.banned && !isBanned) {
            isBanned = true;
            showBanModal(data.banReason || "–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã");
            updateBanStatus(true);
          } else if (!data.banned && isBanned) {
            isBanned = false;
            hideBanModal();
            updateBanStatus(false);
          }
        }
      });
    }

    function updateBanStatus(banned) {
      const banStatus = document.getElementById("ban-status");
      if (banned) {
        banStatus.textContent = "–°—Ç–∞—Ç—É—Å: –ó–∞–±–∞–Ω–µ–Ω";
        banStatus.className = "text-xs px-2 py-1 rounded bg-red-100 text-red-800 mt-1";
      } else {
        banStatus.textContent = "–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–µ–Ω";
        banStatus.className = "text-xs px-2 py-1 rounded bg-green-100 text-green-800 mt-1";
      }
    }

    function showBanModal(reason) {
      document.getElementById("ban-reason").textContent = reason;
      document.getElementById("ban-modal").classList.remove("hidden");
      document.getElementById("game-content").classList.add("hidden");
    }

    function hideBanModal() {
      document.getElementById("ban-modal").classList.add("hidden");
      document.getElementById("game-content").classList.remove("hidden");
    }

    // ========================
    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (fallback)
    // ========================

    function initLocalStorage() {
      updateLoadingText("–ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...");
      userId = "local_" + Math.floor(100000 + Math.random() * 900000);
      document.getElementById("uid").textContent = userId;
      updateBanStatus(false);
      
      gameData.score = parseInt(localStorage.getItem("score")) || 0;
      gameData.energy = parseInt(localStorage.getItem("energy")) || 100;
      gameData.maxEnergy = parseInt(localStorage.getItem("maxEnergy")) || 100;
      gameData.coinsPerClick = parseInt(localStorage.getItem("cpc")) || 1;
      gameData.currentSkin = parseInt(localStorage.getItem("skin")) || 0;
      gameData.upgradeLevel = parseInt(localStorage.getItem("upgradeLevel")) || 0;
      gameData.upgradeCost = parseInt(localStorage.getItem("upgradeCost")) || 50;
      gameData.energyUpgradeLevel = parseInt(localStorage.getItem("energyUpgradeLevel")) || 0;
      gameData.energyUpgradeCost = parseInt(localStorage.getItem("energyUpgradeCost")) || 50;
      gameData.autoclickerLevel = parseInt(localStorage.getItem("autoclickerLevel")) || 0;
      gameData.autoclickerCost = parseInt(localStorage.getItem("autoclickerCost")) || 1000;
      
      const savedSkins = localStorage.getItem("skins");
      if (savedSkins) {
        const parsedSkins = JSON.parse(savedSkins);
        skins.forEach(skin => {
          const savedSkin = parsedSkins.find(s => s.id === skin.id);
          if (savedSkin) {
            skin.owned = savedSkin.owned;
          }
        });
      }
      
      businesses.forEach(b => {
        const ownedStored = localStorage.getItem(`business-owned-${b.id}`);
        if (ownedStored !== null) b.owned = ownedStored === "true";
      });
      
      setTimeout(() => {
        document.getElementById("loading-screen").style.display = "none";
        initGame();
      }, 500);
    }

    function saveLocalData() {
      localStorage.setItem("score", gameData.score);
      localStorage.setItem("energy", gameData.energy);
      localStorage.setItem("maxEnergy", gameData.maxEnergy);
      localStorage.setItem("cpc", gameData.coinsPerClick);
      localStorage.setItem("skin", gameData.currentSkin);
      localStorage.setItem("upgradeLevel", gameData.upgradeLevel);
      localStorage.setItem("upgradeCost", gameData.upgradeCost);
      localStorage.setItem("energyUpgradeLevel", gameData.energyUpgradeLevel);
      localStorage.setItem("energyUpgradeCost", gameData.energyUpgradeCost);
      localStorage.setItem("autoclickerLevel", gameData.autoclickerLevel);
      localStorage.setItem("autoclickerCost", gameData.autoclickerCost);
      
      localStorage.setItem("skins", JSON.stringify(skins.map(s => ({ id: s.id, owned: s.owned }))));
      
      businesses.forEach(b => {
        localStorage.setItem(`business-owned-${b.id}`, b.owned);
      });
    }

    // ========================
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    // ========================

    function updateLoadingText(text) {
      const loadingText = document.getElementById("loading-text");
      if (loadingText) loadingText.textContent = text;
    }

    function showNotification(title, message, type = "info") {
      const notification = document.getElementById("notification");
      const iconElem = document.getElementById("notification-icon");
      const titleElem = document.getElementById("notification-title");
      const messageElem = document.getElementById("notification-message");
      
      switch(type) {
        case "success":
          iconElem.className = "fas fa-check-circle text-green-500";
          break;
        case "error":
          iconElem.className = "fas fa-exclamation-circle text-red-500";
          break;
        case "warning":
          iconElem.className = "fas fa-exclamation-triangle text-yellow-500";
          break;
        default:
          iconElem.className = "fas fa-info-circle text-blue-500";
      }
      
      titleElem.textContent = title;
      messageElem.textContent = message;
      
      notification.classList.add("show");
      
      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }

    function createFloatingCoin(x, y) {
      const floatingCoins = document.getElementById("floating-coins");
      const coin = document.createElement("div");
      coin.className = "floating-coin";
      coin.innerHTML = `<i class="fas fa-coin"></i> +${gameData.coinsPerClick}`;
      coin.style.left = `${x}px`;
      coin.style.top = `${y}px`;
      
      floatingCoins.appendChild(coin);
      
      setTimeout(() => {
        coin.remove();
      }, 1000);
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      document.querySelectorAll('.shop-tab').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      document.getElementById(`tab-${tabName}`).classList.add('active');
      document.getElementById(`shop-${tabName}`).classList.remove('hidden');
      
      if (tabName === 'businesses') {
        updateTotalIncome();
      }
    }

    function updateStats() {
      document.getElementById("cpc-display").textContent = gameData.coinsPerClick;
      
      const totalIncome = businesses.reduce((sum, b) => sum + (b.owned ? b.income : 0), 0);
      document.getElementById("income-display").textContent = totalIncome;
      
      const businessesOwned = businesses.filter(b => b.owned).length;
      document.getElementById("businesses-owned").textContent = businessesOwned;
      
      if (tabName === 'businesses') {
        updateTotalIncome();
      }
    }

    function updateTotalIncome() {
      const totalIncome = businesses.reduce((sum, b) => sum + (b.owned ? b.income : 0), 0);
      document.getElementById("total-income").textContent = totalIncome;
    }

    // ========================
    // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
    // ========================

    function updateScore() {
      document.getElementById("score").innerText = `${gameData.score} ü™ô`;
    }

    function updateEnergy() {
      const percent = (gameData.energy / gameData.maxEnergy) * 100;
      document.getElementById("energy-bar").style.width = `${percent}%`;
      document.getElementById("energy-text").innerText = `${gameData.energy}/${gameData.maxEnergy}`;
      
      if (gameData.energy < 20) {
        document.getElementById("energy-bar").classList.add('energy-low');
      } else {
        document.getElementById("energy-bar").classList.remove('energy-low');
      }
    }

    function updateSkin() {
      const img = document.getElementById("kotokrolik-img");
      const currentSkinData = skins[gameData.currentSkin];
      img.src = currentSkinData.image;
      img.onerror = function() {
        this.onerror = null;
        this.src = 'https://placekitten.com/200/200';
      };
      document.getElementById("kotokrolik-name").innerText = currentSkinData.name;
    }

    function updateUpgradeDisplay() {
      document.getElementById("upgrade-level").innerText = gameData.upgradeLevel;
      document.getElementById("upgrade-cost").innerText = gameData.upgradeCost;
      document.getElementById("energy-upgrade-level").innerText = gameData.energyUpgradeLevel;
      document.getElementById("energy-upgrade-cost").innerText = gameData.energyUpgradeCost;
      document.getElementById("autoclicker-level").innerText = gameData.autoclickerLevel;
      document.getElementById("autoclicker-cost").innerText = gameData.autoclickerCost;
    }

    function tap(event) {
      if (isBanned) return;
      
      if (gameData.energy > 0) {
        gameData.score += gameData.coinsPerClick;
        gameData.energy--;
        
        if (event) {
          const rect = document.getElementById("character-container").getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          createFloatingCoin(x, y);
        }
        
        updateScore();
        updateEnergy();
        updateStats();
        if (userDocRef) {
          saveGameData();
        } else {
          saveLocalData();
        }
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!", "–ü–æ–¥–æ–∂–¥–∏, –ø–æ–∫–∞ —ç–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è", "warning");
      }
    }

    function buyUpgrade() {
      if (isBanned) return;
      
      if (gameData.score >= gameData.upgradeCost) {
        gameData.score -= gameData.upgradeCost;
        gameData.coinsPerClick++;
        gameData.upgradeLevel++;
        gameData.upgradeCost = Math.floor(gameData.upgradeCost * 1.5);
        
        updateScore();
        updateUpgradeDisplay();
        updateStats();
        if (userDocRef) {
          saveGameData();
        } else {
          saveLocalData();
        }
        showNotification("–£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!", `–¢–µ–ø–µ—Ä—å –∑–∞ –∫–ª–∏–∫: ${gameData.coinsPerClick} –º–æ–Ω–µ—Ç`, "success");
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!", "–ó–∞—Ä–∞–±–æ—Ç–∞–π –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ", "error");
      }
    }

    function buyEnergyUpgrade() {
      if (isBanned) return;
      
      if (gameData.score >= gameData.energyUpgradeCost) {
        gameData.score -= gameData.energyUpgradeCost;
        gameData.energyUpgradeLevel++;
        gameData.maxEnergy += 20;
        gameData.energy = gameData.maxEnergy;
        gameData.energyUpgradeCost = Math.floor(gameData.energyUpgradeCost * 1.5);
        
        updateScore();
        updateEnergy();
        updateUpgradeDisplay();
        if (userDocRef) {
          saveGameData();
        } else {
          saveLocalData();
        }
        showNotification("–≠–Ω–µ—Ä–≥–∏—è —É–ª—É—á—à–µ–Ω–∞!", `–ú–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ ${gameData.maxEnergy}`, "success");
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!", "–ó–∞—Ä–∞–±–æ—Ç–∞–π –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ", "error");
      }
    }

    function buyAutoclicker() {
      if (isBanned) return;
      
      if (gameData.score >= gameData.autoclickerCost) {
        gameData.score -= gameData.autoclickerCost;
        gameData.autoclickerLevel++;
        gameData.autoclickerCost = Math.floor(gameData.autoclickerCost * 2);
        
        updateScore();
        updateUpgradeDisplay();
        if (userDocRef) {
          saveGameData();
        } else {
          saveLocalData();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
        startAutoclicker();
        
        showNotification("–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –∫—É–ø–ª–µ–Ω!", `–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª–∏–∫–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (–£—Ä–æ–≤–µ–Ω—å: ${gameData.autoclickerLevel})`, "success");
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!", "–ó–∞—Ä–∞–±–æ—Ç–∞–π –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä", "error");
      }
    }

    function startAutoclicker() {
      if (autoclickerInterval) {
        clearInterval(autoclickerInterval);
      }
      
      autoclickerInterval = setInterval(() => {
        if (gameData.autoclickerLevel > 0 && !isBanned) {
          const clicks = gameData.autoclickerLevel;
          for (let i = 0; i < clicks; i++) {
            gameData.score += gameData.coinsPerClick;
          }
          updateScore();
          if (userDocRef) {
            saveGameData();
          } else {
            saveLocalData();
          }
        }
      }, 5000); // –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    }

    // ========================
    // –°–∫–∏–Ω—ã
    // ========================

    function renderSkins() {
      const skinsList = document.getElementById("skins-list");
      skinsList.innerHTML = "";
      
      skins.forEach((skin, i) => {
        const skinElem = document.createElement("div");
        skinElem.className = `shop-item bg-gray-50 p-4 rounded-lg ${skin.owned ? 'border-l-4 border-purple-500' : ''}`;
        
        skinElem.innerHTML = `
          <div class="flex items-center">
            <img src="${skin.image}" class="w-16 h-16 rounded-lg object-cover mr-4 border-2 ${gameData.currentSkin === i ? 'border-purple-500' : 'border-gray-300'}" onerror="this.onerror=null; this.src='https://placekitten.com/100/100'">
            <div class="flex-1">
              <h3 class="font-bold text-gray-800">${skin.name}</h3>
              <div class="flex items-center mt-1">
                ${skin.owned ? 
                  `<span class="badge bg-green-100 text-green-800">–ö—É–ø–ª–µ–Ω–æ</span>` : 
                  `<span class="text-amber-600 font-bold"><i class="fas fa-coins mr-1"></i>${skin.price}</span>`
                }
              </div>
            </div>
            <button class="${skin.owned ? 
              (gameData.currentSkin === i ? 
                'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default' : 
                'bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg') : 
              (gameData.score >= skin.price ? 
                'bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg' : 
                'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default')
            }">
              ${skin.owned ? 
                (gameData.currentSkin === i ? '–í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å') : 
                (gameData.score >= skin.price ? '–ö—É–ø–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ')
              }
            </button>
          </div>
        `;
        
        const button = skinElem.querySelector("button");
        button.addEventListener("click", () => {
          if (isBanned) return;
          
          if (skin.owned) {
            if (gameData.currentSkin !== i) {
              gameData.currentSkin = i;
              updateSkin();
              if (userDocRef) {
                saveGameData();
              } else {
                saveLocalData();
              }
              renderSkins();
              showNotification("–°–∫–∏–Ω –∏–∑–º–µ–Ω–µ–Ω!", `–¢–µ–ø–µ—Ä—å —Ç—ã ${skin.name}`, "success");
            }
          } else if (gameData.score >= skin.price) {
            gameData.score -= skin.price;
            skin.owned = true;
            gameData.currentSkin = i;
            updateScore();
            updateSkin();
            if (userDocRef) {
              saveGameData();
            } else {
              saveLocalData();
            }
            renderSkins();
            showNotification("–°–∫–∏–Ω –∫—É–ø–ª–µ–Ω!", `–¢–µ–ø–µ—Ä—å —Ç—ã ${skin.name}`, "success");
          }
        });
        
        skinsList.appendChild(skinElem);
      });
    }

    // ========================
    // –ë–∏–∑–Ω–µ—Å—ã (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
    // ========================

    function renderBusinesses() {
      const busList = document.getElementById("businesses-list");
      busList.innerHTML = "";
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –±–∏–∑–Ω–µ—Å—ã –ø–æ —É—Ä–æ–≤–Ω—è–º
      const tiers = {};
      businesses.forEach(bus => {
        if (!tiers[bus.tier]) {
          tiers[bus.tier] = [];
        }
        tiers[bus.tier].push(bus);
      });
      
      // –°–æ–∑–¥–∞–µ–º —Å–µ–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
      Object.keys(tiers).sort((a, b) => a - b).forEach(tier => {
        const tierBusinesses = tiers[tier];
        const ownedCount = tierBusinesses.filter(b => b.owned).length;
        
        const tierHeader = document.createElement("div");
        tierHeader.className = "mb-3 mt-4 first:mt-0";
        tierHeader.innerHTML = `
          <div class="flex justify-between items-center">
            <h3 class="font-bold text-gray-700">–£—Ä–æ–≤–µ–Ω—å ${tier}</h3>
            <span class="text-sm text-gray-600">${ownedCount}/${tierBusinesses.length}</span>
          </div>
        `;
        busList.appendChild(tierHeader);
        
        tierBusinesses.forEach(bus => {
          const busElem = document.createElement("div");
          busElem.className = `business-card p-4 rounded-lg mb-2 ${bus.owned ? 'business-owned' : ''}`;
          
          const tierColors = {
            1: 'from-blue-50 to-blue-100',
            2: 'from-green-50 to-green-100',
            3: 'from-yellow-50 to-yellow-100',
            4: 'from-orange-50 to-orange-100',
            5: 'from-red-50 to-red-100',
            6: 'from-purple-50 to-purple-100'
          };
          
          busElem.innerHTML = `
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-12 h-12 rounded-lg ${tierColors[tier]} flex items-center justify-center mr-4">
                  <i class="${bus.icon} text-${['blue', 'green', 'yellow', 'orange', 'red', 'purple'][tier-1]}-600 text-xl"></i>
                </div>
                <div>
                  <h3 class="font-bold text-gray-800">${bus.name}</h3>
                  <p class="text-sm text-gray-600">–î–æ—Ö–æ–¥: <span class="font-bold text-green-600">${bus.income} ü™ô/—Å–µ–∫</span></p>
                </div>
              </div>
              <div class="text-right">
                <div class="text-amber-600 font-bold mb-1"><i class="fas fa-coins mr-1"></i>${bus.price.toLocaleString()}</div>
                <button class="${bus.owned ? 
                  'bg-green-500 text-white px-4 py-2 rounded-lg cursor-default text-sm' : 
                  (gameData.score >= bus.price ? 
                    `bg-${['blue', 'green', 'yellow', 'orange', 'red', 'purple'][tier-1]}-500 hover:bg-${['blue', 'green', 'yellow', 'orange', 'red', 'purple'][tier-1]}-600 text-white px-4 py-2 rounded-lg text-sm` : 
                    'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default text-sm')
                }">
                  ${bus.owned ? '–ö—É–ø–ª–µ–Ω–æ' : (gameData.score >= bus.price ? '–ö—É–ø–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ')}
                </button>
              </div>
            </div>
          `;
          
          const button = busElem.querySelector("button");
          if (!bus.owned) {
            button.addEventListener("click", () => {
              if (isBanned) return;
              
              if (gameData.score >= bus.price) {
                gameData.score -= bus.price;
                bus.owned = true;
                updateScore();
                updateStats();
                updateTotalIncome();
                if (userDocRef) {
                  saveGameData();
                } else {
                  saveLocalData();
                }
                renderBusinesses();
                showNotification("–ë–∏–∑–Ω–µ—Å –∫—É–ø–ª–µ–Ω!", `–¢—ã –ø—Ä–∏–æ–±—Ä–µ–ª ${bus.name} (+${bus.income} ü™ô/—Å–µ–∫)`, "success");
              }
            });
          }
          
          busList.appendChild(busElem);
        });
      });
    }

    // ========================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    // ========================

    function initGame() {
      updateScore();
      updateEnergy();
      updateUpgradeDisplay();
      updateStats();
      renderSkins();
      renderBusinesses();
      updateSkin();
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
      if (gameData.autoclickerLevel > 0) {
        startAutoclicker();
      }
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
      document.getElementById("character-container").addEventListener("click", tap);
      
      // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
      setInterval(() => {
        if (gameData.energy < gameData.maxEnergy) {
          gameData.energy += 1;
          updateEnergy();
          if (userDocRef) {
            saveGameData();
          } else {
            saveLocalData();
          }
        }
      }, 1000);
      
      // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
      setInterval(() => {
        if (isBanned) return;
        
        let income = businesses.reduce((sum, b) => sum + (b.owned ? b.income : 0), 0);
        if (income > 0) {
          gameData.score += income;
          updateScore();
          if (userDocRef) {
            saveGameData();
          } else {
            saveLocalData();
          }
        }
      }, 1000);
    }

    // ========================
    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    // ========================

    window.addEventListener('load', function() {
      setTimeout(() => {
        if (typeof firebase !== 'undefined' && firebase.app) {
          initFirebase();
        } else {
          updateLoadingText("Firebase –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...");
          setTimeout(() => {
            initLocalStorage();
          }, 2000);
        }
      }, 500);
    });
  </script>
</body>
</html>
