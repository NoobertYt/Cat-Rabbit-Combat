<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KotoKombat - –ó–∞–≤–æ–¥—å –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- –î–æ–±–∞–≤–ª—è–µ–º Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
    
    :root {
      --primary: #8b5cf6;
      --secondary: #ec4899;
      --accent: #f59e0b;
      --dark: #1f2937;
      --light: #fdf2f8;
    }
    
    body {
      font-family: 'Comic Neue', cursive;
      background: linear-gradient(135deg, #fdf4ff 0%, #fce7f3 100%);
      min-height: 100vh;
      color: var(--dark);
    }
    
    .game-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header-gradient {
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .character-container {
      position: relative;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .character-img {
      width: 220px;
      height: 220px;
      object-fit: cover;
      border: 4px solid #ddd6fe;
      box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.4), 0 5px 10px -5px rgba(236, 72, 153, 0.2);
    }
    
    .character-container:active {
      transform: scale(0.95);
    }
    
    .floating-coin {
      position: absolute;
      color: #f59e0b;
      font-size: 1.5rem;
      pointer-events: none;
      animation: floatUp 1s ease-in-out forwards;
      z-index: 20;
    }
    
    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-80px) scale(1.5);
      }
    }
    
    .pulse {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .progress-bar {
      height: 1rem;
      border-radius: 9999px;
      background: #e5e7eb;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 9999px;
      background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
      transition: width 0.3s ease;
    }
    
    .shop-item {
      transition: all 0.2s ease;
      border-left: 4px solid transparent;
    }
    
    .shop-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary);
    }
    
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    .tab-button {
      transition: all 0.2s ease;
      border-bottom: 3px solid transparent;
    }
    
    .tab-button.active {
      border-bottom-color: var(--primary);
      color: var(--primary);
    }
    
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem;
      border-radius: 0.5rem;
      background: white;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      max-width: 300px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .energy-low {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
      .character-img {
        width: 180px;
        height: 180px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    .loader {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #8b5cf6;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .auth-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .leaderboard-item {
      transition: all 0.2s ease;
    }

    .leaderboard-item:hover {
      background-color: #f3f4f6;
    }
  </style>
</head>
<body class="min-h-screen p-4">
  <div class="game-container">
    <!-- –®–∞–ø–∫–∞ -->
    <header class="flex justify-between items-center mb-6 p-4 bg-white rounded-xl shadow-lg">
      <div>
        <h1 class="text-3xl font-bold header-gradient">KotoKombat <i class="fas fa-paw"></i></h1>
        <p class="text-sm text-gray-600">–ó–∞–≤–æ–¥—å –º–∏–ª—ã—Ö –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã!</p>
      </div>
      <div class="flex items-center space-x-4">
        <div id="user-info" class="hidden bg-purple-100 px-4 py-2 rounded-lg text-purple-800">
          <i class="fas fa-user"></i> <span id="username">–ì–æ—Å—Ç—å</span>
        </div>
        <button id="auth-btn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg">
          <i class="fas fa-sign-in-alt mr-1"></i> –í–æ–π—Ç–∏
        </button>
        <div id="user-id" class="bg-purple-100 px-4 py-2 rounded-lg font-mono text-purple-800">
          ID: <span id="uid" class="font-bold"></span>
        </div>
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
      <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-6">
        <div class="flex flex-col items-center justify-center">
          <div class="character-container relative mb-6" id="character-container">
            <img id="kotokrolik-img" src="https://placekitten.com/200/200" class="character-img rounded-full pulse">
            <div id="floating-coins"></div>
          </div>
          
          <div class="text-center mb-6">
            <p id="kotokrolik-name" class="text-xl font-bold text-purple-700 mb-2">–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº</p>
            <p id="score" class="text-3xl font-bold text-amber-500 mb-2">0 ü™ô</p>
            <div class="w-full max-w-xs mx-auto mb-2">
              <p class="text-sm font-medium text-blue-600 mb-1">–≠–Ω–µ—Ä–≥–∏—è ‚ö°</p>
              <div class="progress-bar">
                <div id="energy-bar" class="progress-fill" style="width: 100%;"></div>
              </div>
              <p id="energy-text" class="text-sm text-right mt-1 text-gray-600">100/100</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4 w-full max-w-md">
            <button onclick="tap()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition-all duration-200 transform hover:scale-105">
              <i class="fas fa-hand-point-up mr-2"></i>–ö–ª–∏–∫–Ω—É—Ç—å
            </button>
            <button onclick="openAirdrop()" class="bg-gradient-to-r from-amber-400 to-orange-500 hover:from-amber-500 hover:to-orange-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition-all duration-200 transform hover:scale-105">
              <i class="fas fa-gift mr-2"></i>Airdrop
            </button>
          </div>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ú–∞–≥–∞–∑–∏–Ω –∏ –±–∏–∑–Ω–µ—Å—ã -->
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h2 class="text-xl font-bold text-purple-800 mb-4 flex items-center">
          <i class="fas fa-store mr-2"></i> –ú–∞–≥–∞–∑–∏–Ω
        </h2>
        
        <div class="flex border-b border-gray-200 mb-4">
          <button id="tab-upgrades" class="tab-button active flex-1 py-2 text-center font-medium" onclick="switchTab('upgrades')">
            <i class="fas fa-tools mr-1"></i> –£–ª—É—á—à–µ–Ω–∏—è
          </button>
          <button id="tab-skins" class="tab-button flex-1 py-2 text-center font-medium" onclick="switchTab('skins')">
            <i class="fas fa-palette mr-1"></i> –°–∫–∏–Ω—ã
          </button>
          <button id="tab-businesses" class="tab-button flex-1 py-2 text-center font-medium" onclick="switchTab('businesses')">
            <i class="fas fa-industry mr-1"></i> –ë–∏–∑–Ω–µ—Å—ã
          </button>
          <button id="tab-leaderboard" class="tab-button flex-1 py-2 text-center font-medium" onclick="switchTab('leaderboard')">
            <i class="fas fa-trophy mr-1"></i> –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤
          </button>
        </div>
        
        <div id="shop-upgrades" class="shop-tab">
          <div class="shop-item bg-gray-50 p-4 rounded-lg mb-3">
            <div class="flex justify-between items-center">
              <div>
                <h3 class="font-bold text-gray-800">–£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞</h3>
                <p class="text-sm text-gray-600">+1 –∫ –º–æ–Ω–µ—Ç–∞–º –∑–∞ –∫–ª–∏–∫</p>
                <div class="flex items-center mt-1">
                  <span class="badge bg-purple-100 text-purple-800">–£—Ä. <span id="upgrade-level">0</span></span>
                  <span class="text-amber-600 font-bold ml-2"><i class="fas fa-coins mr-1"></i> <span id="upgrade-cost">50</span></span>
                </div>
              </div>
              <button id="buy-upgrade-btn" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                –ö—É–ø–∏—Ç—å
              </button>
            </div>
          </div>
          
          <div class="shop-item bg-gray-50 p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <h3 class="font-bold text-gray-800">–£–ª—É—á—à–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏</h3>
                <p class="text-sm text-gray-600">+20 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏</p>
                <div class="flex items-center mt-1">
                  <span class="badge bg-blue-100 text-blue-800">–£—Ä. <span id="energy-upgrade-level">0</span></span>
                  <span class="text-amber-600 font-bold ml-2"><i class="fas fa-coins mr-1"></i> <span id="energy-upgrade-cost">50</span></span>
                </div>
              </div>
              <button id="buy-energy-upgrade-btn" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                –ö—É–ø–∏—Ç—å
              </button>
            </div>
          </div>
        </div>
        
        <div id="shop-skins" class="shop-tab hidden">
          <div id="skins-list" class="space-y-3"></div>
        </div>
        
        <div id="shop-businesses" class="shop-tab hidden">
          <p class="text-sm text-gray-600 mb-3">–î–æ—Ö–æ–¥ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É</p>
          <div id="businesses-list" class="space-y-3"></div>
        </div>

        <div id="shop-leaderboard" class="shop-tab hidden">
          <p class="text-sm text-gray-600 mb-3">–¢–æ–ø 10 –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –º–æ–Ω–µ—Ç</p>
          <div id="leaderboard-list" class="space-y-2"></div>
        </div>
      </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="notification" class="notification">
      <div class="flex items-start">
        <div id="notification-icon" class="mr-3 text-xl"></div>
        <div>
          <h3 id="notification-title" class="font-bold"></h3>
          <p id="notification-message" class="text-sm"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Airdrop -->
  <div id="airdrop-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
      <div class="bg-amber-400 p-4 flex justify-between items-center">
        <h2 class="text-xl font-bold text-white"><i class="fas fa-gift mr-2"></i> –ó–∞–ø—Ä–æ—Å –Ω–∞ Airdrop</h2>
        <button onclick="closeAirdrop()" class="text-white hover:text-amber-100 text-xl">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="airdrop-form" class="p-6">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">ID –∞–∫–∫–∞—É–Ω—Ç–∞</label>
          <input type="text" id="airdrop-id" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100" readonly />
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">–ü–æ—á–µ–º—É —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å airdrop?</label>
          <textarea id="airdrop-reason" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" required></textarea>
        </div>
        
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-1">–°–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç —Ç—ã —Ö–æ—á–µ—à—å?</label>
          <input type="number" id="airdrop-amount" class="w-full p-3 border border-gray-300 rounded-lg" min="1" required />
        </div>
        
        <button type="submit" class="w-full bg-amber-400 hover:bg-amber-500 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
          <span id="submit-text">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</span>
          <div id="loader" class="loader ml-2 hidden"></div>
        </button>
      </form>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <div id="auth-modal" class="auth-modal hidden">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
      <div class="bg-purple-500 p-4 flex justify-between items-center">
        <h2 class="text-xl font-bold text-white"><i class="fas fa-user mr-2"></i> –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <button onclick="closeAuthModal()" class="text-white hover:text-purple-100 text-xl">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="p-6">
        <div id="login-form">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" id="login-email" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="–í–∞—à email" required />
          </div>
          
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="login-password" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required />
          </div>
          
          <button onclick="login()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg transition-colors mb-4">
            –í–æ–π—Ç–∏
          </button>
          
          <p class="text-center text-sm text-gray-600">
            –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="showRegisterForm()" class="text-purple-500 hover:text-purple-600">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
          </p>
        </div>
        
        <div id="register-form" class="hidden">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="text" id="register-username" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è" required />
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" id="register-email" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="–í–∞—à email" required />
          </div>
          
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="register-password" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" required />
          </div>
          
          <button onclick="register()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg transition-colors mb-4">
            –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
          </button>
          
          <p class="text-center text-sm text-gray-600">
            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="showLoginForm()" class="text-purple-500 hover:text-purple-600">–í–æ–π—Ç–∏</a>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD6b72LrwHZbIslrfVNjwTTJnC8Fu-bkwU",
      authDomain: "kotocrol-d9f49.firebaseapp.com",
      projectId: "kotocrol-d9f49",
      storageBucket: "kotocrol-d9f49.firebasestorage.app",
      messagingSenderId: "559692109036",
      appId: "1:559692109036:web:c4b63571b26dfe3f14c1c9",
      measurementId: "G-ZS81P946ZM"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Discord Webhook
    const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1340000403462422528/1on5uXxAxOrHfdMWtVlboXGJIAOpbg0dyHs8ovPKysDHZEIg4IuIiCSRj7ErXGefGP18";

    // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
    const skins = [
      { id: 0, name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº", image: "https://placekitten.com/200/200", owned: true, price: 0 },
      { id: 1, name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏—Ç–∫–∞ üéÄ", image: "https://placekitten.com/201/201", owned: false, price: 50 },
      { id: 2, name: "–ó–æ–ª–æ—Ç–æ–π –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üèÜ", image: "https://placekitten.com/202/202", owned: false, price: 500 },
      { id: 3, name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üöÄ", image: "https://placekitten.com/203/203", owned: false, price: 2000 }
    ];

    const businesses = [
      { id: 0, name: "–ö–æ—Ñ–µ–π–Ω—è ‚òï", price: 100, income: 1, owned: false, icon: "fa-mug-hot" },
      { id: 1, name: "–ü–µ–∫–∞—Ä–Ω—è üçû", price: 500, income: 5, owned: false, icon: "fa-bread-slice" },
      { id: 2, name: "–ú–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ üì±", price: 2000, income: 20, owned: false, icon: "fa-mobile" },
      { id: 3, name: "–ë—É—Ä–≥–µ—Ä –ö–∏–Ω–≥ üçî", price: 5000, income: 100, owned: false, icon: "fa-hamburger" },
      { id: 4, name: "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä üé¨", price: 15000, income: 300, owned: false, icon: "fa-film" },
      { id: 5, name: "–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä üõçÔ∏è", price: 50000, income: 1000, owned: false, icon: "fa-shopping-cart" }
    ];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
      score: 0,
      maxEnergy: 100,
      energy: 100,
      coinsPerClick: 1,
      currentSkin: 0,
      upgradeLevel: 0,
      upgradeCost: 50,
      energyUpgradeLevel: 0,
      energyUpgradeCost: 50,
      skins: [],
      businesses: [],
      userId: null,
      username: "–ì–æ—Å—Ç—å"
    };

    // ========================
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    // ========================

    function showNotification(title, message, type = "info") {
      const notification = document.getElementById("notification");
      const iconElem = document.getElementById("notification-icon");
      const titleElem = document.getElementById("notification-title");
      const messageElem = document.getElementById("notification-message");
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      switch(type) {
        case "success":
          iconElem.className = "fas fa-check-circle text-green-500";
          break;
        case "error":
          iconElem.className = "fas fa-exclamation-circle text-red-500";
          break;
        case "warning":
          iconElem.className = "fas fa-exclamation-triangle text-yellow-500";
          break;
        default:
          iconElem.className = "fas fa-info-circle text-blue-500";
      }
      
      titleElem.textContent = title;
      messageElem.textContent = message;
      
      notification.classList.add("show");
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }

    function createFloatingCoin(x, y) {
      const floatingCoins = document.getElementById("floating-coins");
      const coin = document.createElement("div");
      coin.className = "floating-coin";
      coin.innerHTML = `<i class="fas fa-coin"></i> +${gameState.coinsPerClick}`;
      coin.style.left = `${x}px`;
      coin.style.top = `${y}px`;
      
      floatingCoins.appendChild(coin);
      
      // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
      setTimeout(() => {
        coin.remove();
      }, 1000);
    }

    function switchTab(tabName) {
      // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
      document.querySelectorAll('.shop-tab').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
      document.getElementById(`tab-${tabName}`).classList.add('active');
      document.getElementById(`shop-${tabName}`).classList.remove('hidden');
      
      // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤, –æ–±–Ω–æ–≤–ª—è–µ–º –µ—ë
      if (tabName === 'leaderboard') {
        loadLeaderboard();
      }
    }

    // ========================
    // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
    // ========================

    function updateScore() {
      document.getElementById("score").innerText = `${gameState.score} ü™ô`;
    }

    function updateEnergy() {
      const percent = (gameState.energy / gameState.maxEnergy) * 100;
      document.getElementById("energy-bar").style.width = `${percent}%`;
      document.getElementById("energy-text").innerText = `${gameState.energy}/${gameState.maxEnergy}`;
      
      // –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ –ø—Ä–∏ –Ω–∏–∑–∫–æ–π —ç–Ω–µ—Ä–≥–∏–∏
      if (gameState.energy < 20) {
        document.getElementById("energy-bar").classList.add('energy-low');
      } else {
        document.getElementById("energy-bar").classList.remove('energy-low');
      }
    }

    function updateSkin() {
      const img = document.getElementById("kotokrolik-img");
      img.src = skins[gameState.currentSkin].image;
      document.getElementById("kotokrolik-name").innerText = skins[gameState.currentSkin].name;
    }

    function updateUpgradeDisplay() {
      document.getElementById("upgrade-level").innerText = gameState.upgradeLevel;
      document.getElementById("upgrade-cost").innerText = gameState.upgradeCost;
      document.getElementById("energy-upgrade-level").innerText = gameState.energyUpgradeLevel;
      document.getElementById("energy-upgrade-cost").innerText = gameState.energyUpgradeCost;
    }

    function tap(event) {
      if (gameState.energy > 0) {
        gameState.score += gameState.coinsPerClick;
        gameState.energy--;
        
        // –°–æ–∑–¥–∞–µ–º –ª–µ—Ç–∞—é—â—É—é –º–æ–Ω–µ—Ç–∫—É
        if (event) {
          const rect = document.getElementById("character-container").getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          createFloatingCoin(x, y);
        }
        
        updateScore();
        updateEnergy();
        saveGameToFirebase();
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!", "–ü–æ–¥–æ–∂–¥–∏, –ø–æ–∫–∞ —ç–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è", "warning");
      }
    }

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
    setInterval(() => {
      if (gameState.energy < gameState.maxEnergy) {
        gameState.energy += 1;
        updateEnergy();
        saveGameToFirebase();
      }
    }, 1000);

    // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
    setInterval(() => {
      let income = 0;
      gameState.businesses.forEach(businessId => {
        const business = businesses.find(b => b.id === businessId);
        if (business) income += business.income;
      });
      
      if (income > 0) {
        gameState.score += income;
        updateScore();
        saveGameToFirebase();
      }
    }, 1000);

    // ========================
    // –ú–∞–≥–∞–∑–∏–Ω—ã
    // ========================

    // –ê–ø–≥—Ä–µ–π–¥—ã
    document.getElementById("buy-upgrade-btn").addEventListener("click", () => {
      if (gameState.score >= gameState.upgradeCost) {
        gameState.score -= gameState.upgradeCost;
        gameState.coinsPerClick++;
        gameState.upgradeLevel++;
        gameState.upgradeCost = Math.floor(gameState.upgradeCost * 1.5);
        updateScore();
        updateUpgradeDisplay();
        saveGameToFirebase();
        showNotification("–£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!", `–¢–µ–ø–µ—Ä—å –∑–∞ –∫–ª–∏–∫: ${gameState.coinsPerClick} –º–æ–Ω–µ—Ç`, "success");
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!", "–ó–∞—Ä–∞–±–æ—Ç–∞–π –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ", "error");
      }
    });

    document.getElementById("buy-energy-upgrade-btn").addEventListener("click", () => {
      if (gameState.score >= gameState.energyUpgradeCost) {
        gameState.score -= gameState.energyUpgradeCost;
        gameState.energyUpgradeLevel++;
        gameState.maxEnergy += 20;
        gameState.energy = gameState.maxEnergy;
        gameState.energyUpgradeCost = Math.floor(gameState.energyUpgradeCost * 1.5);
        updateScore();
        updateEnergy();
        updateUpgradeDisplay();
        saveGameToFirebase();
        showNotification("–≠–Ω–µ—Ä–≥–∏—è —É–ª—É—á—à–µ–Ω–∞!", `–ú–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ ${gameState.maxEnergy}`, "success");
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!", "–ó–∞—Ä–∞–±–æ—Ç–∞–π –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ", "error");
      }
    });

    // –°–∫–∏–Ω—ã
    function renderSkins() {
      const skinsList = document.getElementById("skins-list");
      skinsList.innerHTML = "";
      
      skins.forEach((skin, i) => {
        const isOwned = gameState.skins.includes(skin.id);
        const skinElem = document.createElement("div");
        skinElem.className = `shop-item bg-gray-50 p-4 rounded-lg ${isOwned ? 'border-l-4 border-purple-500' : ''}`;
        
        skinElem.innerHTML = `
          <div class="flex items-center">
            <img src="${skin.image}" class="w-16 h-16 rounded-lg object-cover mr-4 border-2 ${gameState.currentSkin === i ? 'border-purple-500' : 'border-gray-300'}">
            <div class="flex-1">
              <h3 class="font-bold text-gray-800">${skin.name}</h3>
              <div class="flex items-center mt-1">
                ${isOwned ? 
                  `<span class="badge bg-green-100 text-green-800">–ö—É–ø–ª–µ–Ω–æ</span>` : 
                  `<span class="text-amber-600 font-bold"><i class="fas fa-coins mr-1"></i>${skin.price}</span>`
                }
              </div>
            </div>
            <button class="${isOwned ? 
              (gameState.currentSkin === i ? 
                'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default' : 
                'bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg') : 
              (gameState.score >= skin.price ? 
                'bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg' : 
                'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default')
            }">
              ${isOwned ? 
                (gameState.currentSkin === i ? '–í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å') : 
                (gameState.score >= skin.price ? '–ö—É–ø–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ')
              }
            </button>
          </div>
        `;
        
        const button = skinElem.querySelector("button");
        if (isOwned || gameState.score >= skin.price) {
          button.addEventListener("click", () => {
            if (isOwned) {
              gameState.currentSkin = i;
              updateSkin();
              saveGameToFirebase();
              renderSkins();
              showNotification("–°–∫–∏–Ω –∏–∑–º–µ–Ω–µ–Ω!", `–¢–µ–ø–µ—Ä—å —Ç—ã ${skin.name}`, "success");
            } else if (gameState.score >= skin.price) {
              gameState.score -= skin.price;
              gameState.skins.push(skin.id);
              gameState.currentSkin = i;
              updateScore();
              updateSkin();
              saveGameToFirebase();
              renderSkins();
              showNotification("–°–∫–∏–Ω –∫—É–ø–ª–µ–Ω!", `–¢–µ–ø–µ—Ä—å —Ç—ã ${skin.name}`, "success");
            }
          });
        }
        
        skinsList.appendChild(skinElem);
      });
    }

    // –ë–∏–∑–Ω–µ—Å—ã
    function renderBusinesses() {
      const busList = document.getElementById("businesses-list");
      busList.innerHTML = "";
      
      businesses.forEach(bus => {
        const isOwned = gameState.businesses.includes(bus.id);
        const busElem = document.createElement("div");
        busElem.className = `shop-item bg-gray-50 p-4 rounded-lg ${isOwned ? 'border-l-4 border-green-500' : ''}`;
        
        busElem.innerHTML = `
          <div class="flex items-center">
            <div class="w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center mr-4">
              <i class="${bus.icon} text-purple-600 text-xl"></i>
            </div>
            <div class="flex-1">
              <h3 class="font-bold text-gray-800">${bus.name}</h3>
              <p class="text-sm text-gray-600">–î–æ—Ö–æ–¥: ${bus.income} ü™ô/—Å–µ–∫</p>
              <div class="flex items-center mt-1">
                ${isOwned ? 
                  `<span class="badge bg-green-100 text-green-800">–ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–æ</span>` : 
                  `<span class="text-amber-600 font-bold"><i class="fas fa-coins mr-1"></i>${bus.price}</span>`
                }
              </div>
            </div>
            <button class="${isOwned ? 
              'bg-green-500 text-white px-4 py-2 rounded-lg cursor-default' : 
              (gameState.score >= bus.price ? 
                'bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg' : 
                'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default')
            }">
              ${isOwned ? '–ö—É–ø–ª–µ–Ω–æ' : (gameState.score >= bus.price ? '–ö—É–ø–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ')}
            </button>
          </div>
        `;
        
        const button = busElem.querySelector("button");
        if (!isOwned) {
          button.addEventListener("click", () => {
            if (gameState.score >= bus.price) {
              gameState.score -= bus.price;
              gameState.businesses.push(bus.id);
              updateScore();
              saveGameToFirebase();
              renderBusinesses();
              showNotification("–ë–∏–∑–Ω–µ—Å –∫—É–ø–ª–µ–Ω!", `–¢—ã –ø—Ä–∏–æ–±—Ä–µ–ª ${bus.name}`, "success");
            }
          });
        }
        
        busList.appendChild(busElem);
      });
    }

    // –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
    async function loadLeaderboard() {
      const leaderboardList = document.getElementById("leaderboard-list");
      leaderboardList.innerHTML = '<div class="text-center py-4"><div class="loader mx-auto"></div></div>';
      
      try {
        const snapshot = await db.collection("users")
          .orderBy("score", "desc")
          .limit(10)
          .get();
        
        leaderboardList.innerHTML = "";
        
        if (snapshot.empty) {
          leaderboardList.innerHTML = '<p class="text-center text-gray-500 py-4">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∏–¥–µ—Ä–æ–≤</p>';
          return;
        }
        
        let rank = 1;
        snapshot.forEach(doc => {
          const user = doc.data();
          const isCurrentUser = user.userId === gameState.userId;
          
          const leaderItem = document.createElement("div");
          leaderItem.className = `leaderboard-item p-3 rounded-lg ${isCurrentUser ? 'bg-purple-100 border border-purple-200' : 'bg-gray-50'}`;
          
          leaderItem.innerHTML = `
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <span class="font-bold ${rank === 1 ? 'text-yellow-500 text-lg' : rank === 2 ? 'text-gray-400' : rank === 3 ? 'text-amber-700' : 'text-gray-600'} w-6">${rank}</span>
                <span class="ml-2 font-medium ${isCurrentUser ? 'text-purple-700' : 'text-gray-800'}">${user.username || '–ê–Ω–æ–Ω–∏–º'}</span>
              </div>
              <span class="font-bold text-amber-600">${user.score} ü™ô</span>
            </div>
          `;
          
          leaderboardList.appendChild(leaderItem);
          rank++;
        });
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤:", error);
        leaderboardList.innerHTML = '<p class="text-center text-red-500 py-4">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤</p>';
      }
    }

    // ========================
    // Airdrop —Å–∏—Å—Ç–µ–º–∞
    // ========================

    function openAirdrop() {
      document.getElementById("airdrop-id").value = gameState.userId;
      document.getElementById("airdrop-modal").classList.remove("hidden");
    }

    function closeAirdrop() {
      document.getElementById("airdrop-modal").classList.add("hidden");
      document.getElementById("airdrop-reason").value = "";
      document.getElementById("airdrop-amount").value = "";
    }

    async function sendToDiscord(data) {
      try {
        const response = await fetch(DISCORD_WEBHOOK, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            content: `üì¶ **–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ Airdrop!**\n\n` +
                     `üë§ ID: ${data.id}\n` +
                     `üë§ –ò–º—è: ${data.username}\n` +
                     `üí¨ –ü—Ä–∏—á–∏–Ω–∞: ${data.reason}\n` +
                     `üí∞ –ó–∞–ø—Ä–æ—à–µ–Ω–æ: ${data.amount} ü™ô\n` +
                     `‚è∞ ${new Date().toLocaleString()}`
          })
        });
        return response.ok;
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", error);
        return false;
      }
    }

    document.getElementById("airdrop-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const submitBtn = document.querySelector("#airdrop-form button[type='submit']");
      const submitText = document.getElementById("submit-text");
      const loader = document.getElementById("loader");
      
      const reason = document.getElementById("airdrop-reason").value.trim();
      const amount = document.getElementById("airdrop-amount").value;

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
      submitText.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
      loader.classList.remove("hidden");
      submitBtn.disabled = true;

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
      const success = await sendToDiscord({
        id: gameState.userId,
        username: gameState.username,
        reason: reason,
        amount: amount
      });

      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      if (success) {
        submitText.textContent = "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!";
        loader.classList.add("hidden");
        
        setTimeout(() => {
          closeAirdrop();
          submitText.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å";
          submitBtn.disabled = false;
          showNotification("–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!", "–û–∂–∏–¥–∞–π—Ç–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞", "success");
        }, 1500);
      } else {
        submitText.textContent = "–û—à–∏–±–∫–∞!";
        loader.classList.add("hidden");
        
        setTimeout(() => {
          submitText.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å";
          submitBtn.disabled = false;
          showNotification("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏", "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ", "error");
        }, 1500);
      }
    });

    // ========================
    // Firebase —Ñ—É–Ω–∫—Ü–∏–∏
    // ========================

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã –≤ Firebase
    async function saveGameToFirebase() {
      if (!gameState.userId) return;
      
      try {
        await db.collection("users").doc(gameState.userId).set({
          userId: gameState.userId,
          username: gameState.username,
          score: gameState.score,
          maxEnergy: gameState.maxEnergy,
          energy: gameState.energy,
          coinsPerClick: gameState.coinsPerClick,
          currentSkin: gameState.currentSkin,
          upgradeLevel: gameState.upgradeLevel,
          upgradeCost: gameState.upgradeCost,
          energyUpgradeLevel: gameState.energyUpgradeLevel,
          energyUpgradeCost: gameState.energyUpgradeCost,
          skins: gameState.skins,
          businesses: gameState.businesses,
          lastPlayed: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã:", error);
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã –∏–∑ Firebase
    async function loadGameFromFirebase(userId) {
      try {
        const doc = await db.collection("users").doc(userId).get();
        
        if (doc.exists) {
          const data = doc.data();
          gameState.score = data.score || 0;
          gameState.maxEnergy = data.maxEnergy || 100;
          gameState.energy = data.energy || gameState.maxEnergy;
          gameState.coinsPerClick = data.coinsPerClick || 1;
          gameState.currentSkin = data.currentSkin || 0;
          gameState.upgradeLevel = data.upgradeLevel || 0;
          gameState.upgradeCost = data.upgradeCost || 50;
          gameState.energyUpgradeLevel = data.energyUpgradeLevel || 0;
          gameState.energyUpgradeCost = data.energyUpgradeCost || 50;
          gameState.skins = data.skins || [0];
          gameState.businesses = data.businesses || [];
          gameState.username = data.username || "–ì–æ—Å—Ç—å";
          
          updateScore();
          updateEnergy();
          updateUpgradeDisplay();
          renderSkins();
          renderBusinesses();
          updateSkin();
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          document.getElementById("username").textContent = gameState.username;
          document.getElementById("user-info").classList.remove("hidden");
        }
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã:", error);
        showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏", "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É", "error");
      }
    }

    // ========================
    // –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    // ========================

    function openAuthModal() {
      document.getElementById("auth-modal").classList.remove("hidden");
    }

    function closeAuthModal() {
      document.getElementById("auth-modal").classList.add("hidden");
    }

    function showLoginForm() {
      document.getElementById("login-form").classList.remove("hidden");
      document.getElementById("register-form").classList.add("hidden");
    }

    function showRegisterForm() {
      document.getElementById("login-form").classList.add("hidden");
      document.getElementById("register-form").classList.remove("hidden");
    }

    async function login() {
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;
      
      if (!email || !password) {
        showNotification("–û—à–∏–±–∫–∞", "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "error");
        return;
      }
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        gameState.userId = user.uid;
        document.getElementById("uid").textContent = user.uid;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await loadGameFromFirebase(user.uid);
        
        closeAuthModal();
        showNotification("–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥", `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${gameState.username}!`, "success");
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.getElementById("auth-btn").innerHTML = '<i class="fas fa-sign-out-alt mr-1"></i> –í—ã–π—Ç–∏';
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error);
        showNotification("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞", "–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å", "error");
      }
    }

    async function register() {
      const username = document.getElementById("register-username").value;
      const email = document.getElementById("register-email").value;
      const password = document.getElementById("register-password").value;
      
      if (!username || !email || !password) {
        showNotification("–û—à–∏–±–∫–∞", "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "error");
        return;
      }
      
      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        gameState.userId = user.uid;
        gameState.username = username;
        document.getElementById("uid").textContent = user.uid;
        document.getElementById("username").textContent = username;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        await saveGameToFirebase();
        
        closeAuthModal();
        showNotification("–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è", `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}!`, "success");
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.getElementById("auth-btn").innerHTML = '<i class="fas fa-sign-out-alt mr-1"></i> –í—ã–π—Ç–∏';
        document.getElementById("user-info").classList.remove("hidden");
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:", error);
        showNotification("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏", "–í–æ–∑–º–æ–∂–Ω–æ, email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è", "error");
      }
    }

    async function logout() {
      try {
        await auth.signOut();
        gameState.userId = null;
        gameState.username = "–ì–æ—Å—Ç—å";
        
        document.getElementById("uid").textContent = "–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω";
        document.getElementById("username").textContent = "–ì–æ—Å—Ç—å";
        document.getElementById("user-info").classList.add("hidden");
        document.getElementById("auth-btn").innerHTML = '<i class="fas fa-sign-in-alt mr-1"></i> –í–æ–π—Ç–∏';
        
        showNotification("–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω", "–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞", "info");
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", error);
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    document.getElementById("auth-btn").addEventListener("click", () => {
      if (gameState.userId) {
        logout();
      } else {
        openAuthModal();
      }
    });

    // –°–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        gameState.userId = user.uid;
        document.getElementById("uid").textContent = user.uid;
        await loadGameFromFirebase(user.uid);
        document.getElementById("auth-btn").innerHTML = '<i class="fas fa-sign-out-alt mr-1"></i> –í—ã–π—Ç–∏';
      } else {
        // –ì–æ—Å—Ç—å - —Å–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π ID
        const guestId = localStorage.getItem("guest_id") || `guest_${Math.floor(100000 + Math.random() * 900000)}`;
        localStorage.setItem("guest_id", guestId);
        
        gameState.userId = guestId;
        document.getElementById("uid").textContent = guestId;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –≥–æ—Å—Ç—è
        loadGameFromLocalStorage();
      }
    });

    // ========================
    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –≥–æ—Å—Ç–µ–π
    // ========================

    function saveGameToLocalStorage() {
      if (!gameState.userId || gameState.userId.startsWith('guest_')) {
        localStorage.setItem("gameState", JSON.stringify(gameState));
      }
    }

    function loadGameFromLocalStorage() {
      const savedGame = localStorage.getItem("gameState");
      if (savedGame) {
        const parsedGame = JSON.parse(savedGame);
        Object.assign(gameState, parsedGame);
        
        updateScore();
        updateEnergy();
        updateUpgradeDisplay();
        renderSkins();
        renderBusinesses();
        updateSkin();
      }
    }

    // ========================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    // ========================

    function init() {
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
      document.getElementById("character-container").addEventListener("click", tap);
      
      // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
      setInterval(() => {
        if (gameState.userId) {
          if (gameState.userId.startsWith('guest_')) {
            saveGameToLocalStorage();
          } else {
            saveGameToFirebase();
          }
        }
      }, 30000);
    }

    init();
  </script>
</body>
</html>
