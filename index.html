<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KotoKombat</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  <style>
    .kotokrolik {
      transition: transform 0.1s;
    }
    .kotokrolik:active {
      transform: scale(0.9);
    }
    #user-id {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(255 255 255 / 0.8);
      padding: 6px 10px;
      border-radius: 8px;
      font-weight: bold;
      color: #5b21b6;
      box-shadow: 0 0 6px rgba(91,33,182,0.6);
      z-index: 1000;
      user-select: text;
    }
    #airdrop-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(3px);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    #airdrop-modal.active {
      display: flex;
    }
    #shop-upgrades, #shop-skins, #shop-businesses {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      max-width: 350px;
      width: 100%;
      padding: 1rem;
      margin-top: 1rem;
      text-align: left;
      max-height: 400px;
      overflow-y: auto;
    }
    #shop-upgrades.hidden, #shop-skins.hidden, #shop-businesses.hidden {
      display: none;
    }
    .shop-item {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    .shop-item:last-child {
      border-bottom: none;
    }
    .shop-item button {
      background: #6366f1;
      color: white;
      padding: 0.3rem 0.7rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .shop-item button:hover:enabled {
      background: #4f46e5;
    }
    .skin-preview {
      width: 64px;
      height: 64px;
      border-radius: 0.75rem;
      object-fit: cover;
      border: 2px solid #ddd;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-pink-100 to-purple-200 min-h-screen flex flex-col items-center justify-center p-6 gap-6">

  <div id="user-id">ID: <span id="uid"></span></div>

  <div class="bg-white shadow-2xl rounded-2xl p-4 w-full max-w-sm text-center">
    <img id="kotokrolik-img" src="images/kotokrolik.jpg" class="kotokrolik w-48 h-48 mx-auto rounded-full border-4 border-purple-300 shadow-lg cursor-pointer" onclick="tap()">
    <p id="kotokrolik-name" class="text-lg font-medium text-purple-800 mt-4">–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº</p>
    <p id="score" class="text-2xl font-bold text-pink-600">Kotokrocoin: 0 ü™ô</p>
    <p id="energy" class="text-md font-medium text-blue-600">–≠–Ω–µ—Ä–≥–∏—è: 100/100 ‚ö°</p>

    <div class="flex flex-col gap-2 mt-4">
      <button onclick="toggleShop('upgrades')" class="bg-green-500 hover:bg-green-600 text-white rounded-xl px-4 py-2 shadow">–ê–ø–≥—Ä–µ–π–¥—ã üõ†Ô∏è</button>
      <button onclick="toggleShop('skins')" class="bg-purple-500 hover:bg-purple-600 text-white rounded-xl px-4 py-2 shadow">–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ üé®</button>
      <button onclick="toggleShop('businesses')" class="bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl px-4 py-2 shadow">–ë–∏–∑–Ω–µ—Å—ã üè≠</button>
      <button onclick="openAirdrop()" class="bg-yellow-400 hover:bg-yellow-500 text-white rounded-xl px-4 py-2 shadow">Airdrop üì¶</button>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω –∞–ø–≥—Ä–µ–π–¥–æ–≤ -->
    <div id="shop-upgrades" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-green-700">–ê–ø–≥—Ä–µ–π–¥—ã</h3>

      <div class="shop-item">
        <div>
          <strong>–£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞</strong><br />
          <small>+1 –∫ –º–æ–Ω–µ—Ç–∞–º –∑–∞ –∫–ª–∏–∫</small><br />
          <small>–£—Ä–æ–≤–µ–Ω—å: <span id="upgrade-level">0</span></small><br />
          <small>–¶–µ–Ω–∞: <span id="upgrade-cost"></span> ü™ô</small>
        </div>
        <button id="buy-upgrade-btn">–ö—É–ø–∏—Ç—å</button>
      </div>

      <div class="shop-item">
        <div>
          <strong>–£–ª—É—á—à–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏</strong><br />
          <small>+20 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏</small><br />
          <small>–£—Ä–æ–≤–µ–Ω—å: <span id="energy-upgrade-level">0</span></small><br />
          <small>–¶–µ–Ω–∞: <span id="energy-upgrade-cost"></span> ü™ô</small>
        </div>
        <button id="buy-energy-upgrade-btn">–ö—É–ø–∏—Ç—å</button>
      </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ -->
    <div id="shop-skins" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-purple-700">–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</h3>
      <div id="skins-list"></div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω –±–∏–∑–Ω–µ—Å–æ–≤ -->
    <div id="shop-businesses" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-indigo-700">–ë–∏–∑–Ω–µ—Å—ã</h3>
      <div id="businesses-list"></div>
      <p class="mt-4 text-sm text-gray-600">–î–æ—Ö–æ–¥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.</p>
    </div>
  </div>

  <!-- Airdrop Modal -->
  <div id="airdrop-modal" class="items-center">
    <div class="bg-white p-6 rounded-xl shadow-xl max-w-sm w-full relative">
      <button onclick="closeAirdrop()" class="absolute top-2 right-2 text-red-500 font-bold">‚úï</button>
      <h2 class="text-lg font-bold text-yellow-500 mb-4">–ó–∞–ø—Ä–æ—Å –Ω–∞ Airdrop</h2>
      <form id="airdrop-form">
        <label class="block mb-2 text-sm font-medium">ID –∞–∫–∫–∞—É–Ω—Ç–∞</label>
        <input type="text" id="airdrop-id" class="w-full mb-4 p-2 border rounded" readonly />

        <label class="block mb-2 text-sm font-medium">–ü–æ—á–µ–º—É —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å airdrop?</label>
        <textarea id="airdrop-reason" class="w-full mb-4 p-2 border rounded" rows="2"></textarea>

        <label class="block mb-2 text-sm font-medium">–°–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç —Ç—ã —Ö–æ—á–µ—à—å?</label>
        <input type="number" id="airdrop-amount" class="w-full mb-4 p-2 border rounded" />

        <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded w-full">–û—Ç–ø—Ä–∞–≤–∏—Ç—å üöÄ</button>
      </form>
    </div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
    const userId = localStorage.getItem("user_id") || Math.floor(100000 + Math.random() * 900000);
    localStorage.setItem("user_id", userId);
    document.getElementById("uid").innerText = userId;

    const skins = [
      { id: 0, name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº", image: "images/kotokrolik.jpg", owned: true, price: 0 },
      { id: 1, name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏—Ç–∫–∞ üéÄ", image: "images/kotokrolitka.jpg", owned: false, price: 50 }
    ];

    const businesses = [
      { id: 0, name: "–ö–æ—Ñ–µ–π–Ω—è ‚òï", price: 100, income: 1, owned: false },
      { id: 1, name: "–ü–µ–∫–∞—Ä–Ω—è üçû", price: 500, income: 5, owned: false },
      { id: 2, name: "–ú–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ üì±", price: 2000, income: 20, owned: false }
    ];

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    let score = parseInt(localStorage.getItem("score")) || 0;
    let maxEnergy = parseInt(localStorage.getItem("maxEnergy")) || 100;
    let energy = parseInt(localStorage.getItem("energy")) || maxEnergy;
    let coinsPerClick = parseInt(localStorage.getItem("cpc")) || 1;
    let currentSkin = parseInt(localStorage.getItem("skin")) || 0;

    let upgradeLevel = parseInt(localStorage.getItem("upgradeLevel")) || 0;
    let upgradeCost = parseInt(localStorage.getItem("upgradeCost")) || 50;

    let energyUpgradeLevel = parseInt(localStorage.getItem("energyUpgradeLevel")) || 0;
    let energyUpgradeCost = parseInt(localStorage.getItem("energyUpgradeCost")) || 50;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–∑–Ω–µ—Å–æ–≤
    businesses.forEach(b => {
      const ownedStored = localStorage.getItem(`business-owned-${b.id}`);
      if (ownedStored !== null) b.owned = ownedStored === "true";
    });

    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã
    function saveGame() {
      localStorage.setItem("score", score);
      localStorage.setItem("energy", energy);
      localStorage.setItem("maxEnergy", maxEnergy);
      localStorage.setItem("cpc", coinsPerClick);
      localStorage.setItem("skin", currentSkin);
      localStorage.setItem("upgradeLevel", upgradeLevel);
      localStorage.setItem("upgradeCost", upgradeCost);
      localStorage.setItem("energyUpgradeLevel", energyUpgradeLevel);
      localStorage.setItem("energyUpgradeCost", energyUpgradeCost);
      businesses.forEach(b => {
        localStorage.setItem(`business-owned-${b.id}`, b.owned);
      });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function updateScore() {
      document.getElementById("score").innerText = `Kotokrocoin: ${score} ü™ô`;
    }

    function updateEnergy() {
      document.getElementById("energy").innerText = `–≠–Ω–µ—Ä–≥–∏—è: ${energy}/${maxEnergy} ‚ö°`;
    }

    function updateSkin() {
      const img = document.getElementById("kotokrolik-img");
      img.src = skins[currentSkin].image;
      document.getElementById("kotokrolik-name").innerText = skins[currentSkin].name;
    }

    function updateUpgradeDisplay() {
      document.getElementById("upgrade-level").innerText = upgradeLevel;
      document.getElementById("upgrade-cost").innerText = upgradeCost;
      document.getElementById("energy-upgrade-level").innerText = energyUpgradeLevel;
      document.getElementById("energy-upgrade-cost").innerText = energyUpgradeCost;
    }

    // –ö–ª–∏–∫ –ø–æ –∫–æ—Ç—É
    function tap() {
      if (energy > 0) {
        score += coinsPerClick;
        energy--;
        updateScore();
        updateEnergy();
        saveGame();
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏! –ü–æ–¥–æ–∂–¥–∏ –Ω–µ–º–Ω–æ–≥–æ.");
      }
    }

    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
    setInterval(() => {
      if (energy < maxEnergy) {
        energy += 1; // +1 —ç–Ω–µ—Ä–≥–∏—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        updateEnergy();
        saveGame();
      }
    }, 1000);

    // –î–æ—Ö–æ–¥ –æ—Ç –±–∏–∑–Ω–µ—Å–æ–≤
    setInterval(() => {
      let income = 0;
      businesses.forEach(b => {
        if (b.owned) income += b.income;
      });
      if (income > 0) {
        score += income;
        updateScore();
        saveGame();
      }
    }, 1000);

    // –ú–∞–≥–∞–∑–∏–Ω—ã
    function toggleShop(shopName) {
      ["upgrades", "skins", "businesses"].forEach(name => {
        document.getElementById(`shop-${name}`).classList.add("hidden");
      });
      document.getElementById(`shop-${shopName}`).classList.remove("hidden");
    }

    // –ê–ø–≥—Ä–µ–π–¥ –∫–ª–∏–∫–∞
    document.getElementById("buy-upgrade-btn").addEventListener("click", () => {
      if (score >= upgradeCost) {
        score -= upgradeCost;
        coinsPerClick++;
        upgradeLevel++;
        upgradeCost = Math.floor(upgradeCost * 1.5);
        updateScore();
        updateUpgradeDisplay();
        saveGame();
        alert(`–£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –∑–∞ –∫–ª–∏–∫: ${coinsPerClick} –º–æ–Ω–µ—Ç`);
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
      }
    });

    // –ê–ø–≥—Ä–µ–π–¥ —ç–Ω–µ—Ä–≥–∏–∏
    document.getElementById("buy-energy-upgrade-btn").addEventListener("click", () => {
      if (score >= energyUpgradeCost) {
        score -= energyUpgradeCost;
        energyUpgradeLevel++;
        maxEnergy += 20;
        energy = maxEnergy; // –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
        energyUpgradeCost = Math.floor(energyUpgradeCost * 1.5);
        updateScore();
        updateEnergy();
        updateUpgradeDisplay();
        saveGame();
        alert(`–ú–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ ${maxEnergy}!`);
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
      }
    });

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–∫–∏–Ω–æ–≤
    function renderSkins() {
      const skinsList = document.getElementById("skins-list");
      skinsList.innerHTML = "";
      skins.forEach((skin, i) => {
        const div = document.createElement("div");
        div.className = "shop-item";

        const preview = document.createElement("img");
        preview.src = skin.image;
        preview.className = "skin-preview";

        const info = document.createElement("div");
        info.innerHTML = `<strong>${skin.name}</strong><br>${skin.owned ? "‚úì –ö—É–ø–ª–µ–Ω–æ" : `–¶–µ–Ω–∞: ${skin.price} ü™ô`}`;

        const btn = document.createElement("button");
        btn.textContent = skin.owned ? (currentSkin === i ? "–í—ã–±—Ä–∞–Ω–æ" : "–í—ã–±—Ä–∞—Ç—å") : "–ö—É–ø–∏—Ç—å";
        btn.disabled = skin.owned && currentSkin === i;

        btn.addEventListener("click", () => {
          if (skin.owned) {
            currentSkin = i;
            updateSkin();
            saveGame();
            renderSkins();
          } else if (score >= skin.price) {
            score -= skin.price;
            skin.owned = true;
            currentSkin = i;
            updateScore();
            updateSkin();
            saveGame();
            renderSkins();
          } else {
            alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
          }
        });

        div.appendChild(preview);
        div.appendChild(info);
        div.appendChild(btn);
        skinsList.appendChild(div);
      });
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–∏–∑–Ω–µ—Å–æ–≤
    function renderBusinesses() {
      const busList = document.getElementById("businesses-list");
      busList.innerHTML = "";
      businesses.forEach(bus => {
        const div = document.createElement("div");
        div.className = "shop-item";

        const info = document.createElement("div");
        info.innerHTML = `<strong>${bus.name}</strong><br>–¶–µ–Ω–∞: ${bus.price} ü™ô<br>–î–æ—Ö–æ–¥: ${bus.income} ü™ô/—Å–µ–∫`;

        const btn = document.createElement("button");
        btn.textContent = bus.owned ? "‚úì –ö—É–ø–ª–µ–Ω–æ" : "–ö—É–ø–∏—Ç—å";
        btn.disabled = bus.owned;

        btn.addEventListener("click", () => {
          if (score >= bus.price) {
            score -= bus.price;
            bus.owned = true;
            updateScore();
            saveGame();
            renderBusinesses();
          } else {
            alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
          }
        });

        div.appendChild(info);
        div.appendChild(btn);
        busList.appendChild(div);
      });
    }

    // Airdrop
    function openAirdrop() {
      document.getElementById("airdrop-id").value = userId;
      document.getElementById("airdrop-modal").classList.add("active");
    }

    function closeAirdrop() {
      document.getElementById("airdrop-modal").classList.remove("active");
    }

    document.getElementById("airdrop-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const reason = document.getElementById("airdrop-reason").value;
      const amount = document.getElementById("airdrop-amount").value;
      alert(`–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!\nID: ${userId}\n–ü—Ä–∏—á–∏–Ω–∞: ${reason}\n–°—É–º–º–∞: ${amount} ü™ô`);
      closeAirdrop();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    function init() {
      updateScore();
      updateEnergy();
      updateUpgradeDisplay();
      renderSkins();
      renderBusinesses();
      updateSkin();
    }

    init();
  </script>
</body>
</html>
