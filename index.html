<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KotoKombat</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  <style>
    .kotokrolik {
      transition: transform 0.1s;
    }
    .kotokrolik:active {
      transform: scale(0.9);
    }
    #user-id {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(255 255 255 / 0.8);
      padding: 6px 10px;
      border-radius: 8px;
      font-weight: bold;
      color: #5b21b6;
      box-shadow: 0 0 6px rgba(91,33,182,0.6);
      z-index: 1000;
      user-select: text;
    }
    #airdrop-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(3px);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    #airdrop-modal.active {
      display: flex;
    }
    #shop-upgrades, #shop-skins, #shop-businesses {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      max-width: 350px;
      width: 100%;
      padding: 1rem;
      margin-top: 1rem;
      text-align: left;
      max-height: 400px;
      overflow-y: auto;
    }
    #shop-upgrades.hidden, #shop-skins.hidden, #shop-businesses.hidden {
      display: none;
    }
    .shop-item {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }
    .shop-item:last-child {
      border-bottom: none;
    }
    .shop-item button {
      background: #6366f1;
      color: white;
      padding: 0.3rem 0.7rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .shop-item button:hover:enabled {
      background: #4f46e5;
    }
    .skin-preview {
      width: 64px;
      height: 64px;
      border-radius: 0.75rem;
      object-fit: cover;
      border: 2px solid #ddd;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-pink-100 to-purple-200 min-h-screen flex flex-col items-center justify-center p-6 gap-6">

  <div id="user-id">ID: <span id="uid"></span></div>
  <script>
    const uid = localStorage.getItem("user_id") || Math.floor(100000 + Math.random() * 900000);
    localStorage.setItem("user_id", uid);
    document.getElementById("uid").innerText = uid;
  </script>

  <div class="bg-white shadow-2xl rounded-2xl p-4 w-full max-w-sm text-center">
    <img id="kotokrolik-img" src="images/kotokrolik.jpg" class="kotokrolik w-48 h-48 mx-auto rounded-full border-4 border-purple-300 shadow-lg cursor-pointer" onclick="tap()">
    <p id="kotokrolik-name" class="text-lg font-medium text-purple-800 mt-4">–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº</p>
    <p id="score" class="text-2xl font-bold text-pink-600">Kotokrocoin: 0 ü™ô</p>
    <p id="energy" class="text-md font-medium text-blue-600">–≠–Ω–µ—Ä–≥–∏—è: 100/100 ‚ö°</p>

    <div class="flex flex-col gap-2 mt-4">
      <button onclick="toggleShop('upgrades')" class="bg-green-500 hover:bg-green-600 text-white rounded-xl px-4 py-2 shadow">–ê–ø–≥—Ä–µ–π–¥—ã üõ†Ô∏è</button>
      <button onclick="toggleShop('skins')" class="bg-purple-500 hover:bg-purple-600 text-white rounded-xl px-4 py-2 shadow">–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ üé®</button>
      <button onclick="toggleShop('businesses')" class="bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl px-4 py-2 shadow">–ë–∏–∑–Ω–µ—Å—ã üè≠</button>
      <button onclick="openAirdrop()" class="bg-yellow-400 hover:bg-yellow-500 text-white rounded-xl px-4 py-2 shadow">Airdrop üì¶</button>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω –∞–ø–≥—Ä–µ–π–¥–æ–≤ -->
    <div id="shop-upgrades" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-green-700">–ê–ø–≥—Ä–µ–π–¥—ã</h3>
      <div class="shop-item">
        <div>
          <strong>–£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞</strong><br />
          <small>+1 –∫ –º–æ–Ω–µ—Ç–∞–º –∑–∞ –∫–ª–∏–∫</small><br />
          <small>–£—Ä–æ–≤–µ–Ω—å: <span id="upgrade-level">0</span></small>
        </div>
        <button id="buy-upgrade-btn">–ö—É–ø–∏—Ç—å (50 ü™ô)</button>
      </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤ -->
    <div id="shop-skins" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-purple-700">–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</h3>
      <div id="skins-list">
        <!-- JS –ø–æ–¥—Å—Ç–∞–≤–∏—Ç —Å–∫–∏–Ω—ã —Å—é–¥–∞ -->
      </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω –±–∏–∑–Ω–µ—Å–æ–≤ -->
    <div id="shop-businesses" class="hidden mt-6">
      <h3 class="text-xl font-semibold mb-4 text-indigo-700">–ë–∏–∑–Ω–µ—Å—ã</h3>
      <div id="businesses-list">
        <!-- JS –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –±–∏–∑–Ω–µ—Å—ã —Å—é–¥–∞ -->
      </div>
      <p class="mt-4 text-sm text-gray-600">–î–æ—Ö–æ–¥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.</p>
    </div>
  </div>

  <!-- Airdrop Modal -->
  <div id="airdrop-modal" class="items-center">
    <div class="bg-white p-6 rounded-xl shadow-xl max-w-sm w-full relative">
      <button onclick="closeAirdrop()" class="absolute top-2 right-2 text-red-500 font-bold">‚úï</button>
      <h2 class="text-lg font-bold text-yellow-500 mb-4">–ó–∞–ø—Ä–æ—Å –Ω–∞ Airdrop</h2>
      <form id="airdrop-form">
        <label class="block mb-2 text-sm font-medium">ID –∞–∫–∫–∞—É–Ω—Ç–∞</label>
        <input type="text" id="airdrop-id" class="w-full mb-4 p-2 border rounded" readonly>

        <label class="block mb-2 text-sm font-medium">–ü–æ—á–µ–º—É —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å airdrop?</label>
        <textarea id="airdrop-reason" class="w-full mb-4 p-2 border rounded" rows="2"></textarea>

        <label class="block mb-2 text-sm font-medium">–°–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç —Ç—ã —Ö–æ—á–µ—à—å?</label>
        <input type="number" id="airdrop-amount" class="w-full mb-4 p-2 border rounded">

        <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded w-full">–û—Ç–ø—Ä–∞–≤–∏—Ç—å üöÄ</button>
      </form>
    </div>
  </div>

  <script>
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1340000403462422528/1on5uXxAxOrHfdMWtVlboXGJIAOpbg0dyHs8ovPKysDHZEIg4IuIiCSRj7ErXGefGP18";
    const userId = localStorage.getItem("user_id") || "unknown";

    const skins = [
      { id: 0, name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº", image: "images/kotokrolik.jpg", owned: true, price: 0 },
      { id: 1, name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏—Ç–∫–∞ üéÄ", image: "images/kotokrolitka.jpg", owned: false, price: 50 }
    ];

    const businesses = [
      { id: 0, name: "–ö–æ—Ñ–µ–π–Ω—è ‚òï", price: 100, income: 1, owned: false },
      { id: 1, name: "–ü–µ–∫–∞—Ä–Ω—è üçû", price: 500, income: 5, owned: false },
      { id: 2, name: "–ú–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ üì±", price: 2000, income: 20, owned: false }
    ];

    let score = parseInt(localStorage.getItem("score")) || 0;
    let energy = parseInt(localStorage.getItem("energy")) || 100;
    let coinsPerClick = parseInt(localStorage.getItem("cpc")) || 1;
    let currentSkin = parseInt(localStorage.getItem("skin")) || 0;

    let upgradeLevel = parseInt(localStorage.getItem("upgradeLevel")) || 0;
    const upgradeCost = 50;

    // –ó–∞–≥—Ä—É–∑–∫–∞ owned –¥–ª—è –±–∏–∑–Ω–µ—Å–æ–≤
    businesses.forEach(b => {
      const ownedStored = localStorage.getItem(`business-owned-${b.id}`);
      if (ownedStored !== null) b.owned = ownedStored === "true";
    });

    function saveGame() {
      localStorage.setItem("score", score);
      localStorage.setItem("energy", energy);
      localStorage.setItem("cpc", coinsPerClick);
      localStorage.setItem("skin", currentSkin);
      localStorage.setItem("upgradeLevel", upgradeLevel);
      businesses.forEach(b => {
        localStorage.setItem(`business-owned-${b.id}`, b.owned);
      });
    }

    function updateScore() {
      document.getElementById("score").innerText = `Kotokrocoin: ${score} ü™ô`;
    }
    function updateEnergy() {
      document.getElementById("energy").innerText = `–≠–Ω–µ—Ä–≥–∏—è: ${energy}/100 ‚ö°`;
    }

    function tap() {
      if (energy > 0) {
        score += coinsPerClick;
        energy--;
        updateScore();
        updateEnergy();
        saveGame();
      } else {
        alert("–£ —Ç–µ–±—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å —ç–Ω–µ—Ä–≥–∏—è! –ü–æ–¥–æ–∂–¥–∏ –Ω–µ–º–Ω–æ–≥–æ...");
      }
    }

    // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –æ—Ç –±–∏–∑–Ω–µ—Å–æ–≤
    setInterval(() => {
      let totalIncome = 0;
      businesses.forEach(b => {
        if (b.owned) totalIncome += b.income;
      });
      if (totalIncome > 0) {
        score += totalIncome;
        updateScore();
        saveGame();
      }

      if (energy < 100) energy++;
      updateEnergy();
      saveGame();
    }, 1000);

    function toggleShop(type) {
      closeShops();
      document.getElementById(`shop-${type}`).classList.remove("hidden");
    }
    function closeShops() {
      document.querySelectorAll('[id^="shop-"]').forEach(e => e.classList.add("hidden"));
    }

    function openAirdrop() {
      document.getElementById("airdrop-id").value = userId;
      document.getElementById("airdrop-modal").classList.add("active");
    }
    function closeAirdrop() {
      document.getElementById("airdrop-modal").classList.remove("active");
    }

    document.getElementById("airdrop-form").addEventListener("submit", async e => {
      e.preventDefault();
      const reason = document.getElementById("airdrop-reason").value.trim();
      const amount = parseInt(document.getElementById("airdrop-amount").value.trim());

      if (!reason || isNaN(amount) || amount <= 0) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.");

      const data = {
        embeds: [{
          title: "Airdrop –∑–∞–ø—Ä–æ—Å –æ—Ç –∏–≥—Ä–æ–∫–∞",
          color: 0xf1c40f,
          fields: [
            { name: "ID", value: userId },
            { name: "–ü—Ä–∏—á–∏–Ω–∞", value: reason },
            { name: "–ó–∞–ø—Ä–æ—à–µ–Ω–æ –º–æ–Ω–µ—Ç", value: amount.toString() },
            { name: "–¢–µ–∫—É—â–∏–µ –º–æ–Ω–µ—Ç—ã", value: score.toString(), inline: true },
            { name: "–≠–Ω–µ—Ä–≥–∏—è", value: energy.toString(), inline: true }
          ],
          timestamp: new Date().toISOString()
        }]
      };

      try {
        await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        alert("–ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ñ–¥–∏ –æ—Ç–≤–µ—Ç–∞.");
        closeAirdrop();
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.");
        console.error(err);
      }
    });

    function updateSkin() {
      document.getElementById("kotokrolik-img").src = skins[currentSkin].image;
      document.getElementById("kotokrolik-name").innerText = skins[currentSkin].name;
      // –û–±–Ω–æ–≤–∏–º –∫–Ω–æ–ø–∫–∏ —Å–∫–∏–Ω–æ–≤
      skins.forEach((skin, i) => {
        const btn = document.getElementById(`buy-skin-${i}-btn`);
        if (!btn) return;
        if (i === currentSkin) {
          btn.innerText = "–í—ã–±—Ä–∞–Ω";
          btn.disabled = true;
        } else if (skin.owned) {
          btn.innerText = "–í—ã–±—Ä–∞—Ç—å";
          btn.disabled = false;
        } else {
          btn.innerText = `–ö—É–ø–∏—Ç—å (${skin.price} ü™ô)`;
          btn.disabled = false;
        }
      });
    }

    function updateUpgradeDisplay() {
      document.getElementById("upgrade-level").innerText = upgradeLevel;
    }

    document.getElementById("buy-upgrade-btn").addEventListener("click", () => {
      if (score >= upgradeCost) {
        score -= upgradeCost;
        upgradeLevel++;
        coinsPerClick = 1 + upgradeLevel;
        updateScore();
        updateUpgradeDisplay();
        saveGame();
        alert("–ê–ø–≥—Ä–µ–π–¥ –∫—É–ø–ª–µ–Ω! +1 –∫ –º–æ–Ω–µ—Ç–∞–º –∑–∞ –∫–ª–∏–∫.");
      } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∞–ø–≥—Ä–µ–π–¥–∞.");
      }
    });

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–∫–∏–Ω–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
    function renderSkins() {
      const skinsList = document.getElementById("skins-list");
      skinsList.innerHTML = "";
      skins.forEach((skin, i) => {
        const div = document.createElement("div");
        div.className = "shop-item";

        const preview = document.createElement("img");
        preview.src = skin.image;
        preview.alt = skin.name;
        preview.className = "skin-preview";

        const info = document.createElement("div");
        info.innerHTML = `<strong>${skin.name}</strong><br />${skin.owned ? "–í–ª–∞–¥–µ–µ—à—å" : `–¶–µ–Ω–∞: ${skin.price} ü™ô`}`;

        const btn = document.createElement("button");
        btn.id = `buy-skin-${i}-btn`;

        btn.addEventListener("click", () => {
          if (skin.owned) {
            currentSkin = i;
            updateSkin();
            saveGame();
            alert(`–°–∫–∏–Ω "${skin.name}" –≤—ã–±—Ä–∞–Ω.`);
          } else {
            if (score >= skin.price) {
              score -= skin.price;
              skin.owned = true;
              currentSkin = i;
              updateSkin();
              updateScore();
              saveGame();
              alert(`–°–∫–∏–Ω "${skin.name}" –∫—É–ø–ª–µ–Ω –∏ –≤—ã–±—Ä–∞–Ω.`);
              renderSkins();
            } else {
              alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Å–∫–∏–Ω–∞.");
            }
          }
        });

        div.appendChild(preview);
        div.appendChild(info);
        div.appendChild(btn);

        skinsList.appendChild(div);
      });
      updateSkin();
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–∏–∑–Ω–µ—Å–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
    function renderBusinesses() {
      const busList = document.getElementById("businesses-list");
      busList.innerHTML = "";
      businesses.forEach((bus) => {
        const div = document.createElement("div");
        div.className = "shop-item";

        const info = document.createElement("div");
        info.innerHTML = `<strong>${bus.name}</strong><br />–¶–µ–Ω–∞: ${bus.price} ü™ô<br />–î–æ—Ö–æ–¥: ${bus.income} ü™ô/—Å–µ–∫`;

        const btn = document.createElement("button");
        btn.innerText = bus.owned ? "–ö—É–ø–ª–µ–Ω–æ" : "–ö—É–ø–∏—Ç—å";
        btn.disabled = bus.owned;

        btn.addEventListener("click", () => {
          if (score >= bus.price && !bus.owned) {
            score -= bus.price;
            bus.owned = true;
            updateScore();
            saveGame();
            renderBusinesses();
            alert(`–ë–∏–∑–Ω–µ—Å "${bus.name}" –∫—É–ø–ª–µ–Ω!`);
          } else if (!bus.owned) {
            alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –±–∏–∑–Ω–µ—Å–∞.");
          }
        });

        div.appendChild(info);
        div.appendChild(btn);
        busList.appendChild(div);
      });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      updateScore();
      updateEnergy();
      updateUpgradeDisplay();
      renderSkins();
      renderBusinesses();
      updateSkin();
    }
    init();
  </script>

</body>
</html>
