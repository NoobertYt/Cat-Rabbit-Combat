<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KotoKombat - –ó–∞–≤–æ–¥—å –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
      getFirestore, 
      doc, 
      getDoc, 
      setDoc,
      updateDoc,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { 
      getAuth, 
      onAuthStateChanged,
      signInAnonymously
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD6b72LrwHZbIslrfVNjwTTJnC8Fu-bkwU",
      authDomain: "kotocrol-d9f49.firebaseapp.com",
      projectId: "kotocrol-d9f49",
      storageBucket: "kotocrol-d9f49.firebasestorage.app",
      messagingSenderId: "559692109036",
      appId: "1:559692109036:web:c4b63571b26dfe3f14c1c9",
      measurementId: "G-ZS81P946ZM"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ
    window.firebaseApp = {
      app,
      db,
      auth,
      getDoc,
      setDoc,
      updateDoc,
      onSnapshot,
      doc,
      onAuthStateChanged,
      signInAnonymously
    };

    console.log("Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!");
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
    
    :root {
      --primary: #8b5cf6;
      --secondary: #ec4899;
      --accent: #f59e0b;
      --dark: #1f2937;
      --light: #fdf2f8;
    }
    
    body {
      font-family: 'Comic Neue', cursive;
      background: linear-gradient(135deg, #fdf4ff 0%, #fce7f3 100%);
      min-height: 100vh;
      color: var(--dark);
    }
    
    .game-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header-gradient {
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .character-container {
      position: relative;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .character-img {
      width: 220px;
      height: 220px;
      object-fit: cover;
      border: 4px solid #ddd6fe;
      border-radius: 20px;
      box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.4), 0 5px 10px -5px rgba(236, 72, 153, 0.2);
    }
    
    .character-container:active {
      transform: scale(0.95);
    }
    
    .floating-coin {
      position: absolute;
      color: #f59e0b;
      font-size: 1.5rem;
      pointer-events: none;
      animation: floatUp 1s ease-in-out forwards;
      z-index: 20;
    }
    
    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-80px) scale(1.5);
      }
    }
    
    .pulse {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .progress-bar {
      height: 1rem;
      border-radius: 9999px;
      background: #e5e7eb;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      border-radius: 9999px;
      background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
      transition: width 0.3s ease;
    }
    
    .shop-item {
      transition: all 0.2s ease;
      border-left: 4px solid transparent;
    }
    
    .shop-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary);
    }
    
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    .tab-button {
      transition: all 0.2s ease;
      border-bottom: 3px solid transparent;
    }
    
    .tab-button.active {
      border-bottom-color: var(--primary);
      color: var(--primary);
    }
    
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem;
      border-radius: 0.5rem;
      background: white;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      max-width: 300px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .energy-low {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .ban-modal {
      background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%) !important;
    }
    
    .ban-text {
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
      .character-img {
        width: 180px;
        height: 180px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="min-h-screen p-4">
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–∞–Ω–∞ -->
  <div id="ban-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
    <div class="ban-modal rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
      <div class="p-6 text-center">
        <div class="text-6xl mb-4">üö´</div>
        <h2 class="text-2xl font-bold ban-text mb-2">–í–´ –ó–ê–ë–ê–ù–ï–ù–´</h2>
        <p id="ban-reason" class="ban-text mb-4 text-lg">–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã</p>
        <p class="ban-text opacity-90 mb-6">–î–æ—Å—Ç—É–ø –∫ –∏–≥—Ä–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</p>
        <button onclick="location.reload()" class="bg-white text-red-600 font-bold py-3 px-6 rounded-lg hover:bg-gray-100 transition-colors">
          –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞
        </button>
      </div>
    </div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∏–≥—Ä—ã -->
  <div id="game-content">
    <div class="game-container">
      <!-- –®–∞–ø–∫–∞ -->
      <header class="flex justify-between items-center mb-6 p-4 bg-white rounded-xl shadow-lg">
        <div>
          <h1 class="text-3xl font-bold header-gradient">KotoKombat <i class="fas fa-paw"></i></h1>
          <p class="text-sm text-gray-600">–ó–∞–≤–æ–¥—å –º–∏–ª—ã—Ö –∫–æ—Ç–æ–∫—Ä–æ–ª–∏–∫–æ–≤ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã!</p>
        </div>
        <div class="bg-purple-100 px-4 py-2 rounded-lg font-mono text-purple-800">
          ID: <span id="uid" class="font-bold">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          <div id="ban-status" class="text-xs px-2 py-1 rounded bg-green-100 text-green-800 mt-1">–°—Ç–∞—Ç—É—Å: –ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
        </div>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
        <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-6">
          <div class="flex flex-col items-center justify-center">
            <div class="character-container relative mb-6" id="character-container">
              <img id="kotokrolik-img" src="images/kotokrolik.jpg" class="character-img rounded-lg pulse" onerror="this.src='https://placekitten.com/200/200'">
              <div id="floating-coins"></div>
            </div>
            
            <div class="text-center mb-6">
              <p id="kotokrolik-name" class="text-xl font-bold text-purple-700 mb-2">–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº</p>
              <p id="score" class="text-3xl font-bold text-amber-500 mb-2">0 ü™ô</p>
              <div class="w-full max-w-xs mx-auto mb-2">
                <p class="text-sm font-medium text-blue-600 mb-1">–≠–Ω–µ—Ä–≥–∏—è ‚ö°</p>
                <div class="progress-bar">
                  <div id="energy-bar" class="progress-fill" style="width: 100%;"></div>
                </div>
                <p id="energy-text" class="text-sm text-right mt-1 text-gray-600">100/100</p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 w-full max-w-md">
              <button onclick="tap()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition-all duration-200 transform hover:scale-105">
                <i class="fas fa-hand-point-up mr-2"></i>–ö–ª–∏–∫–Ω—É—Ç—å
              </button>
              <button onclick="openAirdrop()" class="bg-gradient-to-r from-amber-400 to-orange-500 hover:from-amber-500 hover:to-orange-600 text-white font-bold py-3 px-4 rounded-xl shadow-md transition-all duration-200 transform hover:scale-105">
                <i class="fas fa-gift mr-2"></i>Airdrop
              </button>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ú–∞–≥–∞–∑–∏–Ω –∏ –±–∏–∑–Ω–µ—Å—ã -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
          <h2 class="text-xl font-bold text-purple-800 mb-4 flex items-center">
            <i class="fas fa-store mr-2"></i> –ú–∞–≥–∞–∑–∏–Ω
          </h2>
          
          <div class="flex border-b border-gray-200 mb-4">
            <button id="tab-upgrades" class="tab-button active flex-1 py-2 text-center font-medium" onclick="switchTab('upgrades')">
              <i class="fas fa-tools mr-1"></i> –£–ª—É—á—à–µ–Ω–∏—è
            </button>
            <button id="tab-skins" class="tab-button flex-1 py-2 text-center font-medium" onclick="switchTab('skins')">
              <i class="fas fa-palette mr-1"></i> –°–∫–∏–Ω—ã
            </button>
            <button id="tab-businesses" class="tab-button flex-1 py-2 text-center font-medium" onclick="switchTab('businesses')">
              <i class="fas fa-industry mr-1"></i> –ë–∏–∑–Ω–µ—Å—ã
            </button>
          </div>
          
          <div id="shop-upgrades" class="shop-tab">
            <div class="shop-item bg-gray-50 p-4 rounded-lg mb-3">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="font-bold text-gray-800">–£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞</h3>
                  <p class="text-sm text-gray-600">+1 –∫ –º–æ–Ω–µ—Ç–∞–º –∑–∞ –∫–ª–∏–∫</p>
                  <div class="flex items-center mt-1">
                    <span class="badge bg-purple-100 text-purple-800">–£—Ä. <span id="upgrade-level">0</span></span>
                    <span class="text-amber-600 font-bold ml-2"><i class="fas fa-coins mr-1"></i> <span id="upgrade-cost">50</span></span>
                  </div>
                </div>
                <button onclick="buyUpgrade()" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                  –ö—É–ø–∏—Ç—å
                </button>
              </div>
            </div>
            
            <div class="shop-item bg-gray-50 p-4 rounded-lg">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="font-bold text-gray-800">–£–ª—É—á—à–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏</h3>
                  <p class="text-sm text-gray-600">+20 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏</p>
                  <div class="flex items-center mt-1">
                    <span class="badge bg-blue-100 text-blue-800">–£—Ä. <span id="energy-upgrade-level">0</span></span>
                    <span class="text-amber-600 font-bold ml-2"><i class="fas fa-coins mr-1"></i> <span id="energy-upgrade-cost">50</span></span>
                  </div>
                </div>
                <button onclick="buyEnergyUpgrade()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                  –ö—É–ø–∏—Ç—å
                </button>
              </div>
            </div>
          </div>
          
          <div id="shop-skins" class="shop-tab hidden">
            <div id="skins-list" class="space-y-3"></div>
          </div>
          
          <div id="shop-businesses" class="shop-tab hidden">
            <p class="text-sm text-gray-600 mb-3">–î–æ—Ö–æ–¥ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É</p>
            <div id="businesses-list" class="space-y-3"></div>
          </div>
        </div>
      </div>

      <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
      <div id="notification" class="notification">
        <div class="flex items-start">
          <div id="notification-icon" class="mr-3 text-xl"></div>
          <div>
            <h3 id="notification-title" class="font-bold"></h3>
            <p id="notification-message" class="text-sm"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Airdrop -->
    <div id="airdrop-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
        <div class="bg-amber-400 p-4 flex justify-between items-center">
          <h2 class="text-xl font-bold text-white"><i class="fas fa-gift mr-2"></i> –ó–∞–ø—Ä–æ—Å –Ω–∞ Airdrop</h2>
          <button onclick="closeAirdrop()" class="text-white hover:text-amber-100 text-xl">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <form id="airdrop-form" class="p-6">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">ID –∞–∫–∫–∞—É–Ω—Ç–∞</label>
            <input type="text" id="airdrop-id" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100" readonly />
          </div>
          
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">–ü–æ—á–µ–º—É —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å airdrop?</label>
            <textarea id="airdrop-reason" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" required></textarea>
          </div>
          
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-1">–°–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç —Ç—ã —Ö–æ—á–µ—à—å?</label>
            <input type="number" id="airdrop-amount" class="w-full p-3 border border-gray-300 rounded-lg" min="1" required />
          </div>
          
          <button type="submit" class="w-full bg-amber-400 hover:bg-amber-500 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
            <span id="submit-text">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</span>
            <div id="loader" class="loader ml-2 hidden"></div>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="loading-screen" class="fixed inset-0 bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center z-50">
    <div class="text-center">
      <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-purple-600 mx-auto mb-4"></div>
      <h2 class="text-2xl font-bold text-purple-800 mb-2">–ó–∞–≥—Ä—É–∑–∫–∞ KotoKombat...</h2>
      <p class="text-purple-600" id="loading-text">–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É</p>
    </div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let userId = null;
    let userDocRef = null;
    let isBanned = false;
    
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1340000403462422528/1on5uXxAxOrHfdMWtVlboXGJIAOpbg0dyHs8ovPKysDHZEIg4IuIiCSRj7ErXGefGP18";
    
    // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
    const skins = [
      { 
        id: 0, 
        name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏–∫ üê∞üòº", 
        image: "images/kotokrolik.jpg", 
        owned: true, 
        price: 0 
      },
      { 
        id: 1, 
        name: "–ö–æ—Ç–æ–∫—Ä–æ–ª–∏—Ç–∫–∞ üéÄ", 
        image: "images/kotokrolitka.jpg", 
        owned: false, 
        price: 50 
      }
    ];

    const businesses = [
      { id: 0, name: "–ö–æ—Ñ–µ–π–Ω—è ‚òï", price: 100, income: 1, owned: false, icon: "fa-mug-hot" },
      { id: 1, name: "–ü–µ–∫–∞—Ä–Ω—è üçû", price: 500, income: 5, owned: false, icon: "fa-bread-slice" },
      { id: 2, name: "–ú–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ üì±", price: 2000, income: 20, owned: false, icon: "fa-mobile" },
      { id: 3, name: "–ë—É—Ä–≥–µ—Ä –ö–∏–Ω–≥ üçî", price: 5000, income: 100, owned: false, icon: "fa-hamburger" },
      { id: 4, name: "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä üé¨", price: 15000, income: 300, owned: false, icon: "fa-film" },
      { id: 5, name: "–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä üõçÔ∏è", price: 50000, income: 1000, owned: false, icon: "fa-shopping-cart" }
    ];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (—Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –≤ Firebase)
    let gameData = {
      score: 0,
      energy: 100,
      maxEnergy: 100,
      coinsPerClick: 1,
      currentSkin: 0,
      upgradeLevel: 0,
      upgradeCost: 50,
      energyUpgradeLevel: 0,
      energyUpgradeCost: 50
    };

    // ========================
    // Firebase —Ñ—É–Ω–∫—Ü–∏–∏
    // ========================

    async function initFirebase() {
      try {
        updateLoadingText("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...");
        
        const { signInAnonymously, onAuthStateChanged, doc, getDoc, setDoc, onSnapshot, updateDoc } = window.firebaseApp;
        
        // –ê–Ω–æ–Ω–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        const authResult = await signInAnonymously(auth);
        userId = authResult.user.uid;
        userDocRef = doc(db, "users", userId);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –±–∞–Ω–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        await checkBanStatus();
        await loadGameData();
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        setupRealtimeListener();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
        setTimeout(() => {
          document.getElementById("loading-screen").style.display = "none";
          initGame();
        }, 500);
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ Firebase:", error);
        showNotification("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è", "–ò–≥—Ä–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ", "error");
        initLocalStorage();
      }
    }

    async function checkBanStatus() {
      try {
        const userDoc = await getDoc(userDocRef);
        
        if (userDoc.exists()) {
          const data = userDoc.data();
          if (data.banned) {
            isBanned = true;
            showBanModal(data.banReason || "–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã");
            updateBanStatus(true);
            return false;
          }
        }
        
        updateBanStatus(false);
        return true;
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–Ω–∞:", error);
        return true;
      }
    }

    async function loadGameData() {
      try {
        const userDoc = await getDoc(userDocRef);
        
        if (userDoc.exists()) {
          const data = userDoc.data();
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
          gameData.score = data.score || 0;
          gameData.energy = data.energy || 100;
          gameData.maxEnergy = data.maxEnergy || 100;
          gameData.coinsPerClick = data.coinsPerClick || 1;
          gameData.currentSkin = data.currentSkin || 0;
          gameData.upgradeLevel = data.upgradeLevel || 0;
          gameData.upgradeCost = data.upgradeCost || 50;
          gameData.energyUpgradeLevel = data.energyUpgradeLevel || 0;
          gameData.energyUpgradeCost = data.energyUpgradeCost || 50;
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫–∏–Ω—ã
          if (data.skins && Array.isArray(data.skins)) {
            data.skins.forEach(savedSkin => {
              const skin = skins.find(s => s.id === savedSkin.id);
              if (skin) skin.owned = savedSkin.owned;
            });
          }
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∏–∑–Ω–µ—Å—ã
          if (data.businesses && Array.isArray(data.businesses)) {
            data.businesses.forEach(savedBusiness => {
              const business = businesses.find(b => b.id === savedBusiness.id);
              if (business) business.owned = savedBusiness.owned;
            });
          }
          
        } else {
          // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          await createNewUser();
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById("uid").textContent = userId.substring(0, 8) + "...";
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
      }
    }

    async function createNewUser() {
      try {
        const initialData = {
          uid: userId,
          score: 0,
          energy: 100,
          maxEnergy: 100,
          coinsPerClick: 1,
          currentSkin: 0,
          upgradeLevel: 0,
          upgradeCost: 50,
          energyUpgradeLevel: 0,
          energyUpgradeCost: 50,
          skins: skins.map(skin => ({ id: skin.id, owned: skin.id === 0 })),
          businesses: businesses.map(b => ({ id: b.id, owned: false })),
          banned: false,
          banReason: "",
          createdAt: new Date().toISOString(),
          lastLogin: new Date().toISOString()
        };
        
        await setDoc(userDocRef, initialData);
        console.log("–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ Firebase");
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
      }
    }

    async function saveGameData() {
      if (!userDocRef || isBanned) return;
      
      try {
        const saveData = {
          score: gameData.score,
          energy: gameData.energy,
          maxEnergy: gameData.maxEnergy,
          coinsPerClick: gameData.coinsPerClick,
          currentSkin: gameData.currentSkin,
          upgradeLevel: gameData.upgradeLevel,
          upgradeCost: gameData.upgradeCost,
          energyUpgradeLevel: gameData.energyUpgradeLevel,
          energyUpgradeCost: gameData.energyUpgradeCost,
          skins: skins.map(skin => ({ id: skin.id, owned: skin.owned })),
          businesses: businesses.map(b => ({ id: b.id, owned: b.owned })),
          lastLogin: new Date().toISOString()
        };
        
        await updateDoc(userDocRef, saveData);
        
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Firebase:", error);
      }
    }

    function setupRealtimeListener() {
      // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –±–∞–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
      onSnapshot(userDocRef, (doc) => {
        if (doc.exists()) {
          const data = doc.data();
          
          if (data.banned && !isBanned) {
            isBanned = true;
            showBanModal(data.banReason || "–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã");
            updateBanStatus(true);
          } else if (!data.banned && isBanned) {
            isBanned = false;
            hideBanModal();
            updateBanStatus(false);
          }
        }
      });
    }

    function updateBanStatus(banned) {
      const banStatus = document.getElementById("ban-status");
      if (banned) {
        banStatus.textContent = "–°—Ç–∞—Ç—É—Å: –ó–∞–±–∞–Ω–µ–Ω";
        banStatus.className = "text-xs px-2 py-1 rounded bg-red-100 text-red-800 mt-1";
      } else {
        banStatus.textContent = "–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–µ–Ω";
        banStatus.className = "text-xs px-2 py-1 rounded bg-green-100 text-green-800 mt-1";
      }
    }

    function showBanModal(reason) {
      document.getElementById("ban-reason").textContent = reason;
      document.getElementById("ban-modal").classList.remove("hidden");
      document.getElementById("game-content").classList.add("hidden");
    }

    function hideBanModal() {
      document.getElementById("ban-modal").classList.add("hidden");
      document.getElementById("game-content").classList.remove("hidden");
    }

    // ========================
    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (fallback)
    // ========================

    function initLocalStorage() {
      userId = "local_" + Math.floor(100000 + Math.random() * 900000);
      document.getElementById("uid").textContent = userId;
      updateBanStatus(false);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
      gameData.score = parseInt(localStorage.getItem("score")) || 0;
      gameData.energy = parseInt(localStorage.getItem("energy")) || 100;
      gameData.maxEnergy = parseInt(localStorage.getItem("maxEnergy")) || 100;
      gameData.coinsPerClick = parseInt(localStorage.getItem("cpc")) || 1;
      gameData.currentSkin = parseInt(localStorage.getItem("skin")) || 0;
      gameData.upgradeLevel = parseInt(localStorage.getItem("upgradeLevel")) || 0;
      gameData.upgradeCost = parseInt(localStorage.getItem("upgradeCost")) || 50;
      gameData.energyUpgradeLevel = parseInt(localStorage.getItem("energyUpgradeLevel")) || 0;
      gameData.energyUpgradeCost = parseInt(localStorage.getItem("energyUpgradeCost")) || 50;
      
      // –°–∫–∏–Ω—ã
      const savedSkins = localStorage.getItem("skins");
      if (savedSkins) {
        const parsedSkins = JSON.parse(savedSkins);
        skins.forEach(skin => {
          const savedSkin = parsedSkins.find(s => s.id === skin.id);
          if (savedSkin) {
            skin.owned = savedSkin.owned;
          }
        });
      }
      
      // –ë–∏–∑–Ω–µ—Å—ã
      businesses.forEach(b => {
        const ownedStored = localStorage.getItem(`business-owned-${b.id}`);
        if (ownedStored !== null) b.owned = ownedStored === "true";
      });
      
      setTimeout(() => {
        document.getElementById("loading-screen").style.display = "none";
        initGame();
      }, 500);
    }

    function saveLocalData() {
      localStorage.setItem("score", gameData.score);
      localStorage.setItem("energy", gameData.energy);
      localStorage.setItem("maxEnergy", gameData.maxEnergy);
      localStorage.setItem("cpc", gameData.coinsPerClick);
      localStorage.setItem("skin", gameData.currentSkin);
      localStorage.setItem("upgradeLevel", gameData.upgradeLevel);
      localStorage.setItem("upgradeCost", gameData.upgradeCost);
      localStorage.setItem("energyUpgradeLevel", gameData.energyUpgradeLevel);
      localStorage.setItem("energyUpgradeCost", gameData.energyUpgradeCost);
      
      localStorage.setItem("skins", JSON.stringify(skins.map(s => ({ id: s.id, owned: s.owned }))));
      
      businesses.forEach(b => {
        localStorage.setItem(`business-owned-${b.id}`, b.owned);
      });
    }

    // ========================
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    // ========================

    function updateLoadingText(text) {
      const loadingText = document.getElementById("loading-text");
      if (loadingText) loadingText.textContent = text;
    }

    function showNotification(title, message, type = "info") {
      const notification = document.getElementById("notification");
      const iconElem = document.getElementById("notification-icon");
      const titleElem = document.getElementById("notification-title");
      const messageElem = document.getElementById("notification-message");
      
      switch(type) {
        case "success":
          iconElem.className = "fas fa-check-circle text-green-500";
          break;
        case "error":
          iconElem.className = "fas fa-exclamation-circle text-red-500";
          break;
        case "warning":
          iconElem.className = "fas fa-exclamation-triangle text-yellow-500";
          break;
        default:
          iconElem.className = "fas fa-info-circle text-blue-500";
      }
      
      titleElem.textContent = title;
      messageElem.textContent = message;
      
      notification.classList.add("show");
      
      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }

    function createFloatingCoin(x, y) {
      const floatingCoins = document.getElementById("floating-coins");
      const coin = document.createElement("div");
      coin.className = "floating-coin";
      coin.innerHTML = `<i class="fas fa-coin"></i> +${gameData.coinsPerClick}`;
      coin.style.left = `${x}px`;
      coin.style.top = `${y}px`;
      
      floatingCoins.appendChild(coin);
      
      setTimeout(() => {
        coin.remove();
      }, 1000);
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      document.querySelectorAll('.shop-tab').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      document.getElementById(`tab-${tabName}`).classList.add('active');
      document.getElementById(`shop-${tabName}`).classList.remove('hidden');
    }

    // ========================
    // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
    // ========================

    function updateScore() {
      document.getElementById("score").innerText = `${gameData.score} ü™ô`;
    }

    function updateEnergy() {
      const percent = (gameData.energy / gameData.maxEnergy) * 100;
      document.getElementById("energy-bar").style.width = `${percent}%`;
      document.getElementById("energy-text").innerText = `${gameData.energy}/${gameData.maxEnergy}`;
      
      if (gameData.energy < 20) {
        document.getElementById("energy-bar").classList.add('energy-low');
      } else {
        document.getElementById("energy-bar").classList.remove('energy-low');
      }
    }

    function updateSkin() {
      const img = document.getElementById("kotokrolik-img");
      const currentSkinData = skins[gameData.currentSkin];
      img.src = currentSkinData.image;
      document.getElementById("kotokrolik-name").innerText = currentSkinData.name;
    }

    function updateUpgradeDisplay() {
      document.getElementById("upgrade-level").innerText = gameData.upgradeLevel;
      document.getElementById("upgrade-cost").innerText = gameData.upgradeCost;
      document.getElementById("energy-upgrade-level").innerText = gameData.energyUpgradeLevel;
      document.getElementById("energy-upgrade-cost").innerText = gameData.energyUpgradeCost;
    }

    function tap(event) {
      if (isBanned) return;
      
      if (gameData.energy > 0) {
        gameData.score += gameData.coinsPerClick;
        gameData.energy--;
        
        if (event) {
          const rect = document.getElementById("character-container").getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          createFloatingCoin(x, y);
        }
        
        updateScore();
        updateEnergy();
        if (userDocRef) {
          saveGameData();
        } else {
          saveLocalData();
        }
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!", "–ü–æ–¥–æ–∂–¥–∏, –ø–æ–∫–∞ —ç–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è", "warning");
      }
    }

    function buyUpgrade() {
      if (isBanned) return;
      
      if (gameData.score >= gameData.upgradeCost) {
        gameData.score -= gameData.upgradeCost;
        gameData.coinsPerClick++;
        gameData.upgradeLevel++;
        gameData.upgradeCost = Math.floor(gameData.upgradeCost * 1.5);
        
        updateScore();
        updateUpgradeDisplay();
        if (userDocRef) {
          saveGameData();
        } else {
          saveLocalData();
        }
        showNotification("–£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!", `–¢–µ–ø–µ—Ä—å –∑–∞ –∫–ª–∏–∫: ${gameData.coinsPerClick} –º–æ–Ω–µ—Ç`, "success");
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!", "–ó–∞—Ä–∞–±–æ—Ç–∞–π –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ", "error");
      }
    }

    function buyEnergyUpgrade() {
      if (isBanned) return;
      
      if (gameData.score >= gameData.energyUpgradeCost) {
        gameData.score -= gameData.energyUpgradeCost;
        gameData.energyUpgradeLevel++;
        gameData.maxEnergy += 20;
        gameData.energy = gameData.maxEnergy;
        gameData.energyUpgradeCost = Math.floor(gameData.energyUpgradeCost * 1.5);
        
        updateScore();
        updateEnergy();
        updateUpgradeDisplay();
        if (userDocRef) {
          saveGameData();
        } else {
          saveLocalData();
        }
        showNotification("–≠–Ω–µ—Ä–≥–∏—è —É–ª—É—á—à–µ–Ω–∞!", `–ú–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞ –¥–æ ${gameData.maxEnergy}`, "success");
      } else {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!", "–ó–∞—Ä–∞–±–æ—Ç–∞–π –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ", "error");
      }
    }

    // ========================
    // –°–∫–∏–Ω—ã (—Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞)
    // ========================

    function renderSkins() {
      const skinsList = document.getElementById("skins-list");
      skinsList.innerHTML = "";
      
      skins.forEach((skin, i) => {
        const skinElem = document.createElement("div");
        skinElem.className = `shop-item bg-gray-50 p-4 rounded-lg ${skin.owned ? 'border-l-4 border-purple-500' : ''}`;
        
        skinElem.innerHTML = `
          <div class="flex items-center">
            <img src="${skin.image}" class="w-16 h-16 rounded-lg object-cover mr-4 border-2 ${gameData.currentSkin === i ? 'border-purple-500' : 'border-gray-300'}" onerror="this.src='https://placekitten.com/100/100'">
            <div class="flex-1">
              <h3 class="font-bold text-gray-800">${skin.name}</h3>
              <div class="flex items-center mt-1">
                ${skin.owned ? 
                  `<span class="badge bg-green-100 text-green-800">–ö—É–ø–ª–µ–Ω–æ</span>` : 
                  `<span class="text-amber-600 font-bold"><i class="fas fa-coins mr-1"></i>${skin.price}</span>`
                }
              </div>
            </div>
            <button class="${skin.owned ? 
              (gameData.currentSkin === i ? 
                'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default' : 
                'bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg') : 
              (gameData.score >= skin.price ? 
                'bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg' : 
                'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default')
            }">
              ${skin.owned ? 
                (gameData.currentSkin === i ? '–í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å') : 
                (gameData.score >= skin.price ? '–ö—É–ø–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ')
              }
            </button>
          </div>
        `;
        
        const button = skinElem.querySelector("button");
        button.addEventListener("click", () => {
          if (isBanned) return;
          
          if (skin.owned) {
            if (gameData.currentSkin !== i) {
              gameData.currentSkin = i;
              updateSkin();
              if (userDocRef) {
                saveGameData();
              } else {
                saveLocalData();
              }
              renderSkins();
              showNotification("–°–∫–∏–Ω –∏–∑–º–µ–Ω–µ–Ω!", `–¢–µ–ø–µ—Ä—å —Ç—ã ${skin.name}`, "success");
            }
          } else if (gameData.score >= skin.price) {
            gameData.score -= skin.price;
            skin.owned = true;
            gameData.currentSkin = i;
            updateScore();
            updateSkin();
            if (userDocRef) {
              saveGameData();
            } else {
              saveLocalData();
            }
            renderSkins();
            showNotification("–°–∫–∏–Ω –∫—É–ø–ª–µ–Ω!", `–¢–µ–ø–µ—Ä—å —Ç—ã ${skin.name}`, "success");
          }
        });
        
        skinsList.appendChild(skinElem);
      });
    }

    // ========================
    // –ë–∏–∑–Ω–µ—Å—ã
    // ========================

    function renderBusinesses() {
      const busList = document.getElementById("businesses-list");
      busList.innerHTML = "";
      
      businesses.forEach(bus => {
        const busElem = document.createElement("div");
        busElem.className = `shop-item bg-gray-50 p-4 rounded-lg ${bus.owned ? 'border-l-4 border-green-500' : ''}`;
        
        busElem.innerHTML = `
          <div class="flex items-center">
            <div class="w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center mr-4">
              <i class="${bus.icon} text-purple-600 text-xl"></i>
            </div>
            <div class="flex-1">
              <h3 class="font-bold text-gray-800">${bus.name}</h3>
              <p class="text-sm text-gray-600">–î–æ—Ö–æ–¥: ${bus.income} ü™ô/—Å–µ–∫</p>
              <div class="flex items-center mt-1">
                ${bus.owned ? 
                  `<span class="badge bg-green-100 text-green-800">–ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–æ</span>` : 
                  `<span class="text-amber-600 font-bold"><i class="fas fa-coins mr-1"></i>${bus.price}</span>`
                }
              </div>
            </div>
            <button class="${bus.owned ? 
              'bg-green-500 text-white px-4 py-2 rounded-lg cursor-default' : 
              (gameData.score >= bus.price ? 
                'bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg' : 
                'bg-gray-400 text-white px-4 py-2 rounded-lg cursor-default')
            }">
              ${bus.owned ? '–ö—É–ø–ª–µ–Ω–æ' : (gameData.score >= bus.price ? '–ö—É–ø–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ')}
            </button>
          </div>
        `;
        
        const button = busElem.querySelector("button");
        if (!bus.owned) {
          button.addEventListener("click", () => {
            if (isBanned) return;
            
            if (gameData.score >= bus.price) {
              gameData.score -= bus.price;
              bus.owned = true;
              updateScore();
              if (userDocRef) {
                saveGameData();
              } else {
                saveLocalData();
              }
              renderBusinesses();
              showNotification("–ë–∏–∑–Ω–µ—Å –∫—É–ø–ª–µ–Ω!", `–¢—ã –ø—Ä–∏–æ–±—Ä–µ–ª ${bus.name}`, "success");
            }
          });
        }
        
        busList.appendChild(busElem);
      });
    }

    // ========================
    // Airdrop —Å–∏—Å—Ç–µ–º–∞
    // ========================

    function openAirdrop() {
      if (isBanned) return;
      
      document.getElementById("airdrop-id").value = userId;
      document.getElementById("airdrop-modal").classList.remove("hidden");
    }

    function closeAirdrop() {
      document.getElementById("airdrop-modal").classList.add("hidden");
      document.getElementById("airdrop-reason").value = "";
      document.getElementById("airdrop-amount").value = "";
    }

    async function sendToDiscord(data) {
      try {
        const response = await fetch(DISCORD_WEBHOOK, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            content: `üì¶ **–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ Airdrop!**\n\n` +
                     `üë§ ID: ${data.id}\n` +
                     `üí¨ –ü—Ä–∏—á–∏–Ω–∞: ${data.reason}\n` +
                     `üí∞ –ó–∞–ø—Ä–æ—à–µ–Ω–æ: ${data.amount} ü™ô\n` +
                     `‚è∞ ${new Date().toLocaleString()}`
          })
        });
        return response.ok;
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", error);
        return false;
      }
    }

    function initAirdrop() {
      document.getElementById("airdrop-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        
        const submitBtn = document.querySelector("#airdrop-form button[type='submit']");
        const submitText = document.getElementById("submit-text");
        const loader = document.getElementById("loader");
        
        const reason = document.getElementById("airdrop-reason").value.trim();
        const amount = document.getElementById("airdrop-amount").value;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        submitText.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
        loader.classList.remove("hidden");
        submitBtn.disabled = true;

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        const success = await sendToDiscord({
          id: userId,
          reason: reason,
          amount: amount
        });

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if (success) {
          submitText.textContent = "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!";
          loader.classList.add("hidden");
          
          setTimeout(() => {
            closeAirdrop();
            submitText.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å";
            submitBtn.disabled = false;
            showNotification("–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!", "–û–∂–∏–¥–∞–π—Ç–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞", "success");
          }, 1500);
        } else {
          submitText.textContent = "–û—à–∏–±–∫–∞!";
          loader.classList.add("hidden");
          
          setTimeout(() => {
            submitText.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å";
            submitBtn.disabled = false;
            showNotification("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏", "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ", "error");
          }, 1500);
        }
      });
    }

    // ========================
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    // ========================

    function initGame() {
      updateScore();
      updateEnergy();
      updateUpgradeDisplay();
      renderSkins();
      renderBusinesses();
      updateSkin();
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
      document.getElementById("character-container").addEventListener("click", tap);
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è airdrop
      initAirdrop();
      
      // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
      setInterval(() => {
        if (gameData.energy < gameData.maxEnergy) {
          gameData.energy += 1;
          updateEnergy();
          if (userDocRef) {
            saveGameData();
          } else {
            saveLocalData();
          }
        }
      }, 1000);
      
      // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
      setInterval(() => {
        if (isBanned) return;
        
        let income = businesses.reduce((sum, b) => sum + (b.owned ? b.income : 0), 0);
        if (income > 0) {
          gameData.score += income;
          updateScore();
          if (userDocRef) {
            saveGameData();
          } else {
            saveLocalData();
          }
        }
      }, 1000);
    }

    // ========================
    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    // ========================

    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ Firebase
    setTimeout(() => {
      if (window.firebaseApp) {
        initFirebase();
      } else {
        updateLoadingText("Firebase –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ");
        setTimeout(() => {
          initLocalStorage();
        }, 1000);
      }
    }, 1000);
  </script>
</body>
</html>
